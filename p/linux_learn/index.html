<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content="基于Linux操作系统的相关学习 树莓派 ROS 等">
<title>【Linux】操作系统的学习</title>

<link rel='canonical' href='https://prominsegsj.github.io/p/linux_learn/'>

<link rel="stylesheet" href="/scss/style.min.84e9e3518f269b022a23d4be353b0038d7bb6000d763cac7f1a0b9b92d507bc7.css"><meta property='og:title' content="【Linux】操作系统的学习">
<meta property='og:description' content="基于Linux操作系统的相关学习 树莓派 ROS 等">
<meta property='og:url' content='https://prominsegsj.github.io/p/linux_learn/'>
<meta property='og:site_name' content='小郭不背锅'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:published_time' content='2025-09-13T00:00:00&#43;00:00'/><meta property='article:modified_time' content='2025-09-13T00:00:00&#43;00:00'/><meta property='og:image' content='https://prominsegsj.github.io/p/linux_learn/2.png' />
<meta name="twitter:title" content="【Linux】操作系统的学习">
<meta name="twitter:description" content="基于Linux操作系统的相关学习 树莓派 ROS 等"><meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content='https://prominsegsj.github.io/p/linux_learn/2.png' />
    <link rel="shortcut icon" href="/favicon.ico" />
<div class="loading">
    <div class="loader"></div>
</div>

<style>
 
.loading {
    position: fixed;
    display: flex;
    justify-content: center;
    align-items: center;
    top: 0; left: 0;
    width: 100%; height: 100%;
    z-index: 99;
    background-color: hsl(199, 63%, 75%);
}

 
.loader {
    position: relative;
    width: 120px;
    height: 90px;
}

.loader:before {
    content: "";
    position: absolute;
    bottom: 30px;
    left: 50px;
    height: 30px;
    width: 30px;
    border-radius: 50%;
    background: #3a88db;
    animation: loading-bounce 0.5s ease-in-out infinite alternate;
}

.loader:after {
    content: "";
    position: absolute;
    right: 0;
    top: 0;
    height: 7px;
    width: 45px;
    border-radius: 4px;
    box-shadow: 0 5px 0 #36a5d9, -35px 50px 0 #36a5d9, -70px 95px 0 #36a5d9;
    animation: loading-step 1s ease-in-out infinite;
}

 
@keyframes loading-bounce {
    0%   { transform: scale(1, 0.7); }
    40%  { transform: scale(0.8, 1.2); }
    60%  { transform: scale(1, 1); }
    100% { bottom: 140px; }
}

 
@keyframes loading-step {
    0% {
        box-shadow: 0 10px 0 rgba(0, 0, 0, 0),
                    0 10px 0 #36a5d9,
                    -35px 50px 0 #36a5d9,
                    -70px 90px 0 #36a5d9;
    }
    100% {
        box-shadow: 0 10px 0 #36a5d9,
                    -35px 50px 0 #36a5d9,
                    -70px 90px 0 #36a5d9,
                    -70px 90px 0 rgba(0, 0, 0, 0);
    }
}

 
@keyframes scaleAndFade {
  0%   { transform: scale(1); opacity: 1; }
  100% { transform: scale(1.2); opacity: 0; }
}

.scaleAndFadeout {
  animation: scaleAndFade 0.5s forwards;  
}
</style>

<script>
function initLoading() {
    let loading = document.querySelector(".loading");
    document.addEventListener('DOMContentLoaded', function() {
        
        setTimeout(() => {
            
            loading.classList.add("scaleAndFadeout");
            loading.addEventListener('animationend', () => {
                loading.style.display = "none";
            });
        }, 1500); 
    });
}
initLoading();
</script>

    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="切换菜单">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/avatar_hu_34ea3bfdb6c513b1.png" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">🫣</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">小郭不背锅</a></h1>
            <h2 class="site-description">欢迎来到小郭不背锅的个人博客频道，这里记录一位梦想成为技术咸鱼家的点点又滴滴！🎈🎇</h2>
        </div>
    </header><ol class="menu-social">
            
                <li>
                    <a 
                        href='https://space.bilibili.com/1782631305'
                        target="_blank"
                        title="Bilibili"
                        rel="me"
                    >
                        
                        
                            <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-brand-bilibili"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 10a4 4 0 0 1 4 -4h10a4 4 0 0 1 4 4v6a4 4 0 0 1 -4 4h-10a4 4 0 0 1 -4 -4v-6z" /><path d="M8 3l2 3" /><path d="M16 3l-2 3" /><path d="M9 13v-2" /><path d="M15 11v2" /></svg>
                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://github.com/prominsegsj'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="currentColor"  class="icon icon-tabler icons-tabler-filled icon-tabler-home"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12.707 2.293l9 9c.63 .63 .184 1.707 -.707 1.707h-1v6a3 3 0 0 1 -3 3h-1v-7a3 3 0 0 0 -2.824 -2.995l-.176 -.005h-2a3 3 0 0 0 -3 3v7h-1a3 3 0 0 1 -3 -3v-6h-1c-.89 0 -1.337 -1.077 -.707 -1.707l9 -9a1 1 0 0 1 1.414 0m.293 11.707a1 1 0 0 1 1 1v7h-4v-7a1 1 0 0 1 .883 -.993l.117 -.007z" /></svg>
                
                <span>主页 | Home</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                    <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="currentColor"  class="icon icon-tabler icons-tabler-filled icon-tabler-archive"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M2 3m0 2a2 2 0 0 1 2 -2h16a2 2 0 0 1 2 2v0a2 2 0 0 1 -2 2h-16a2 2 0 0 1 -2 -2z" /><path d="M19 9c.513 0 .936 .463 .993 1.06l.007 .14v7.2c0 1.917 -1.249 3.484 -2.824 3.594l-.176 .006h-10c-1.598 0 -2.904 -1.499 -2.995 -3.388l-.005 -.212v-7.2c0 -.663 .448 -1.2 1 -1.2h14zm-5 2h-4l-.117 .007a1 1 0 0 0 0 1.986l.117 .007h4l.117 -.007a1 1 0 0 0 0 -1.986l-.117 -.007z" /></svg>
                
                <span>博客归档</span>
            </a>
        </li>
        
        
        <li >
            <a href='/%E5%85%B3%E4%BA%8E%E7%AB%99%E4%B8%BB/' >
                
                
                
                    <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="currentColor"  class="icon icon-tabler icons-tabler-filled icon-tabler-user"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 2a5 5 0 1 1 -5 5l.005 -.217a5 5 0 0 1 4.995 -4.783z" /><path d="M14 14a5 5 0 0 1 5 5v1a2 2 0 0 1 -2 2h-10a2 2 0 0 1 -2 -2v-1a5 5 0 0 1 5 -5h4z" /></svg>
                
                <span>关于站主</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="currentColor"  class="icon icon-tabler icons-tabler-filled icon-tabler-zoom-code"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M14 3.072a8 8 0 0 1 2.32 11.834l5.387 5.387a1 1 0 0 1 -1.414 1.414l-5.388 -5.387a8 8 0 0 1 -12.905 -6.32l.005 -.285a8 8 0 0 1 11.995 -6.643m-5.293 4.22a1 1 0 0 0 -1.414 0l-2 2a1 1 0 0 0 0 1.415l2 2a1 1 0 0 0 1.414 0l.083 -.094a1 1 0 0 0 -.083 -1.32l-1.292 -1.293l1.292 -1.293a1 1 0 0 0 0 -1.414m4 0a1 1 0 0 0 -1.414 0l-.083 .095a1 1 0 0 0 .083 1.32l1.292 1.292l-1.292 1.293a1 1 0 0 0 1.414 1.414l2 -2a1 1 0 0 0 0 -1.414z" /></svg>
                
                <span>本站搜索</span>
            </a>
        </li>
        
        
        <li >
            <a href='/%E5%8F%8B%E6%83%85%E7%B4%A2%E9%81%93/' >
                
                
                
                    <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="currentColor"  class="icon icon-tabler icons-tabler-filled icon-tabler-aerial-lift"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M19.876 2.008a1 1 0 1 1 .248 1.984l-7.124 .891v2.117h4.2a1 1 0 0 1 .688 .274l.087 .093c2.79 3.417 2.717 9.963 -.226 13.295a1 1 0 0 1 -.749 .338h-10.106a1 1 0 0 1 -.763 -.353c-2.86 -3.373 -2.86 -9.92 0 -13.294a1 1 0 0 1 .763 -.353h4.106v-1.867l-6.876 .86a1 1 0 0 1 -1.095 -.754l-.021 -.115a1 1 0 0 1 .868 -1.116l7.996 -1l.011 -.001l.008 -.001zm-8.876 6.992h-3.617l-.051 .072c-.718 1.042 -1.149 2.41 -1.292 3.844l-.008 .084h4.968zm5.698 0h-3.698v4h4.979l-.005 -.072c-.123 -1.436 -.533 -2.811 -1.232 -3.864z" /></svg>
                
                <span>友情索道</span>
            </a>
        </li>
        
        
        <li >
            <a href='/%E6%8A%80%E6%9C%AF%E9%93%BE%E6%8E%A5/' >
                
                
                
                    <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="currentColor"  class="icon icon-tabler icons-tabler-filled icon-tabler-dumpling"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M10.003 2.04a3.53 3.53 0 0 1 2.602 .62l.09 .07l.149 -.11a3.53 3.53 0 0 1 3.044 -.462l.207 .072a3.53 3.53 0 0 1 1.99 1.903l.014 .031l.045 -.004a3.53 3.53 0 0 1 2.624 .879l.153 .144l.358 .358c1.976 1.977 -.32 6.748 -4.655 11.083c-4.336 4.335 -9.106 6.632 -11.083 4.655l-.382 -.382l-.135 -.145a3.53 3.53 0 0 1 -.87 -2.556l.01 -.1l-.162 -.072a3.53 3.53 0 0 1 -1.838 -2.124l-.055 -.192a3.53 3.53 0 0 1 .56 -2.937l.062 -.079l-.07 -.092a3.53 3.53 0 0 1 -.644 -2.401l.025 -.2a3.53 3.53 0 0 1 1.707 -2.505l.046 -.026l-.005 -.14a3.53 3.53 0 0 1 .885 -2.345l.15 -.16l.159 -.149a3.53 3.53 0 0 1 2.346 -.884l.14 .004l.026 -.046a3.53 3.53 0 0 1 2.308 -1.67z" /></svg>
                
                <span>技术链接</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">

                
                    <li id="dark-mode-toggle">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <span>暗色模式</span>
                    </li>
                
            </ol>
        </li>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">目录</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ul>
    <li><a href="#1-linux基础终端">1. Linux基础终端</a></li>
    <li><a href="#2-树莓派学习笔记">2. 树莓派学习笔记</a>
      <ul>
        <li><a href="#21-初步账号设置">2.1 初步账号设置</a></li>
        <li><a href="#22-常用终端指令">2.2 常用终端指令</a></li>
        <li><a href="#23-配置示例代码">2.3 配置示例代码</a></li>
        <li><a href="#24-python开发环境配置venv虚拟环境">2.4 python开发环境配置(venv虚拟环境)</a></li>
        <li><a href="#25-python开发">2.5 python开发</a></li>
        <li><a href="#26-vim编辑器的使用">2.6 vim编辑器的使用</a></li>
      </ul>
    </li>
    <li><a href="#3-ros2学习笔记">3. ROS2学习笔记</a>
      <ul>
        <li><a href="#31-ros2-run">3.1 ros2 run</a></li>
        <li><a href="#32-ros2-node-list">3.2. ros2 node list</a></li>
        <li><a href="#33-重映射">3.3. 重映射</a></li>
        <li><a href="#34-ros2节点信息">3.4. ros2节点信息</a></li>
        <li><a href="#35-编译运行c文件">3.5. 编译运行C++文件</a></li>
        <li><a href="#36-创建功能包">3.6. 创建功能包</a></li>
        <li><a href="#37-其他">3.7. 其他</a></li>
        <li><a href="#38-工作空间workplace">3.8 工作空间(WorkPlace)</a></li>
        <li><a href="#39-python学习">3.9 Python学习</a></li>
        <li><a href="#310-c学习">3.10 C++学习</a></li>
        <li><a href="#311-多线程以及回调函数">3.11 多线程以及回调函数</a></li>
        <li><a href="#312-话题">3.12 话题</a></li>
        <li><a href="#313-服务">3.13 服务</a></li>
      </ul>
    </li>
    <li><a href="#4-心得总结">4. 心得总结</a></li>
  </ul>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="has-image main-article">
    <header class="article-header">
        <div class="article-image">
            <a href="/p/linux_learn/">
                <img src="/p/linux_learn/2_hu_b96b817c7a00abe.png"
                        srcset="/p/linux_learn/2_hu_b96b817c7a00abe.png 800w, /p/linux_learn/2_hu_94b1c81cd92f6411.png 1600w"
                        width="800" 
                        height="457" 
                        loading="lazy"
                        alt="Featured image of post 【Linux】操作系统的学习" />
                
            </a>
        </div>
    

    <div class="article-details">
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/linux_learn/">【Linux】操作系统的学习</a>
        </h2>
    
        
        <h3 class="article-subtitle">
            基于Linux操作系统的相关学习 树莓派 ROS 等
        </h3>
        
    </div>

    
    
    

    <footer class="article-time">
        <div class="article-time-item">
            <?xml version="1.0" ?><svg style="enable-background:new 0 0 64 64;" version="1.1" viewBox="0 0 64 64" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g id="_x32_5_attachment"/><g id="_x32_4_office"/><g id="_x32_3_pin"/><g id="_x32_2_business_card"/><g id="_x32_1_form"/><g id="_x32_0_headset"/><g id="_x31_9_video_call"/><g id="_x31_8_letter_box"/><g id="_x31_7_papperplane"/><g id="_x31_6_laptop"/><g id="_x31_5_connection"/><g id="_x31_4_phonebook"/><g id="_x31_3_classic_telephone"/><g id="_x31_2_sending_mail"/><g id="_x31_1_man_talking"/><g id="_x31_0_date"><g><g><path d="M53.1494,5.7119h-3.8086V5.3877c0-2.3433-1.9063-4.2495-4.249-4.2495c-2.3408,0-4.2461,1.9063-4.2461,4.2495v0.3242     H22.4941V5.2461C22.4941,2.9048,20.5889,1,18.248,1c-2.3428,0-4.249,1.9048-4.249,4.2461v0.4658h-3.1455     c-4.4746,0-8.1143,3.8633-8.1143,8.6123v40.0635c0,4.749,3.6396,8.6123,8.1143,8.6123h42.2959     c4.4727,0,8.1113-3.8633,8.1113-8.6123V14.3242C61.2607,9.5752,57.6221,5.7119,53.1494,5.7119z M42.8457,5.3877     c0-1.2402,1.0078-2.2495,2.2461-2.2495c1.2402,0,2.249,1.0093,2.249,2.2495v3.0596c0,1.2402-1.0088,2.2495-2.249,2.2495     c-1.2383,0-2.2461-1.0093-2.2461-2.2495V5.3877z M15.999,5.2461C15.999,4.0078,17.0078,3,18.248,3     c1.2383,0,2.2461,1.0078,2.2461,2.2461v3.063c0,1.2383-1.0078,2.2461-2.2461,2.2461c-1.2402,0-2.249-1.0078-2.249-2.2461V5.2461z      M59.2607,54.3877c0,3.646-2.7412,6.6123-6.1113,6.6123H10.8535c-3.3711,0-6.1143-2.9663-6.1143-6.6123V17.8652h54.5215V54.3877z      M59.2607,15.8652H4.7393v-1.541c0-3.646,2.7432-6.6123,6.1143-6.6123h3.1455v0.5972c0,2.3413,1.9063,4.2461,4.249,4.2461     c2.3408,0,4.2461-1.9048,4.2461-4.2461V7.7119h18.3516v0.7354c0,2.3433,1.9053,4.2495,4.2461,4.2495     c2.3428,0,4.249-1.9063,4.249-4.2495V7.7119h3.8086c3.3701,0,6.1113,2.9663,6.1113,6.6123V15.8652z"/><path d="M11.4316,56.0688h10.2842h30.8525c0.5527,0,1-0.4478,1-1v-30.854c0-0.5522-0.4473-1-1-1H11.4316c-0.5527,0-1,0.4478-1,1     v30.854C10.4316,55.6211,10.8789,56.0688,11.4316,56.0688z M51.5684,43.7842h-8.2842v-8.2847h8.2842V43.7842z M41.2842,43.7842     H33v-8.2847h8.2842V43.7842z M31,43.7842h-8.2842v-8.2847H31V43.7842z M20.7158,43.7842h-8.2842v-8.2847h8.2842V43.7842z      M12.4316,45.7842h8.2842v8.2847h-8.2842V45.7842z M22.7158,45.7842H31v8.2847h-8.2842V45.7842z M33,45.7842h8.2842v8.2847H33     V45.7842z M51.5684,54.0688h-8.2842v-8.2847h8.2842V54.0688z M51.5684,33.4995h-8.2842v-8.2847h8.2842V33.4995z M41.2842,33.4995     H33v-8.2847h8.2842V33.4995z M31,33.4995h-8.2842v-8.2847H31V33.4995z M12.4316,25.2148h8.2842v8.2847h-8.2842V25.2148z"/></g></g></g><g id="_x30_9_review"/><g id="_x30_8_email"/><g id="_x30_7_information"/><g id="_x30_6_phone_talking"/><g id="_x30_5_women_talking"/><g id="_x30_4_calling"/><g id="_x30_3_women"/><g id="_x30_2_writing"/><g id="_x30_1_chatting"/></svg>
            <time class="article-time--published">2025-09-13</time>
        </div>
    
        <div class="article-time-separator"> | </div>
    
        <div class="article-time-item">
            <?xml version="1.0" ?><svg style="enable-background:new 0 0 24 24;" version="1.1" viewBox="0 0 24 24" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><style type="text/css">
	.st0{display:none;}
</style><g class="st0" id="grid"/><g id="icon"><path d="M8.041,12.659l-1.022,3.708c-0.048,0.173,0.001,0.359,0.128,0.486C7.242,16.949,7.369,17,7.5,17   c0.044,0,0.089-0.006,0.133-0.018l3.708-1.022c0.083-0.023,0.16-0.067,0.221-0.128L23.297,4.096c0.936-0.936,0.936-2.458,0-3.393   c-0.936-0.936-2.458-0.935-3.393,0L8.169,12.438C8.108,12.499,8.063,12.575,8.041,12.659z M8.969,13.052L20.611,1.41   c0.546-0.546,1.434-0.545,1.979,0s0.545,1.434,0,1.979L10.948,15.031l-2.732,0.753L8.969,13.052z"/><path d="M1.818,24h17.364C20.185,24,21,23.185,21,22.182V10.414c0-0.276-0.224-0.5-0.5-0.5s-0.5,0.224-0.5,0.5v11.768   C20,22.633,19.633,23,19.182,23H1.818C1.367,23,1,22.633,1,22.182V4.818C1,4.367,1.367,4,1.818,4h11.768c0.276,0,0.5-0.224,0.5-0.5   S13.862,3,13.586,3H1.818C0.815,3,0,3.815,0,4.818v17.364C0,23.185,0.815,24,1.818,24z"/></g></svg> 
            <span class="article-wordcount">
                19328 字
            </span>
        </div>
    </footer>

    
</div>

</header>

    <section class="article-content">
    
    
    <h1 id="基于linux操作系统下的相关学习">基于Linux操作系统下的相关学习
</h1><blockquote class="alert alert-note">
    <p>(本次学习开发环境都是在虚拟机ubantu24.04.2系统版本以及ROS2的jazzy版本下的记录)本来是想分开来分别记录树莓派跟ROS2的相关学习的，但是想来现在的学习深度和笔记都较为浅，我就暂为放到一起算作总的Linux学习好了🤌🤌<br></p></blockquote>
<h2 id="1-linux基础终端">1. Linux基础终端
</h2><ul>
<li>ls -a【列出当前文件夹内所有文件，包括隐藏文件】</li>
<li>source +文件名称【运行某个文本文件】</li>
<li>~/.bashrc【文件是终端运行时会自动提前运行的脚本】</li>
<li>nano 文件名【文件编辑器编辑/创建文件】</li>
<li>gedit 文件名【文件编辑器编辑/创建文件】</li>
<li>whereis 软件名称【查询安装路径】</li>
<li>code ./ 【使用vscode打开当前文件路径文件夹】</li>
<li>mv 原文件名 重命名文件名 【重命名文件名】</li>
<li>查看当前系统版本：lsb_release -a</li>
</ul>
<h2 id="2-树莓派学习笔记">2. 树莓派学习笔记
</h2><blockquote class="alert alert-tip">
    <p>其实树莓派就是一个集成的小的硬件&quot;小电脑&quot;，安装好对应的树莓派或者其他操作系统就可以正常开发使用了，对应的个人认为较好的教程可以看b站UP<a class="link" href="https://www.bilibili.com/video/BV16U4y1879Q/?spm_id_from=333.337.search-card.all.click&amp;vd_source=b0f5272da83bbf0fd5569aa17bceb192"  target="_blank" rel="noopener"
    >树小溪</a>，整体的环境配置和流程我就不赘述了，详细直接看这个他的视频即可。此处只做个人的学习笔记，仅供参考！补充：本笔记的系统环境是树莓派的官方环境Raspberry Pi OS。<br></p></blockquote>
<h3 id="21-初步账号设置">2.1 初步账号设置
</h3><ul>
<li>主机：miaochuangbalou</li>
<li>密码：111111</li>
<li>地址：192.168.137.92 【此处是我给树莓派配置的固定ip，详细看教程】</li>
</ul>
<h3 id="22-常用终端指令">2.2 常用终端指令
</h3><ul>
<li>终端开启树莓派配置选项：sudo raspi-config</li>
<li>查看当前电脑IP:hostname -I</li>
<li>删除非空目录文件夹：rm -r 文件名</li>
<li>清屏操作：clear</li>
</ul>
<h3 id="23-配置示例代码">2.3 配置示例代码
</h3><ul>
<li>代码1：配置树莓派自动开启vnc
<ul>
<li>例程</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">    <span class="c1">#!/bin/sh </span>
</span></span><span class="line"><span class="cl">    <span class="n">export</span> <span class="n">USER</span><span class="o">=</span><span class="s1">&#39;master&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nb">eval</span> <span class="n">cd</span><span class="o">~</span><span class="err">$</span><span class="n">USER</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="s2">&#34;$1&#34;</span> <span class="ow">in</span>
</span></span><span class="line"><span class="cl">    <span class="n">start</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="c1">#启动命令行。此处自定义分辨率、控制台号码或其它参数。 </span>
</span></span><span class="line"><span class="cl">        <span class="n">su</span> <span class="err">$</span><span class="n">USER</span> <span class="o">-</span><span class="n">c</span> <span class="s1">&#39;/usr/bin/vncserver -depth 24 -geometry 1920x1080:1&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="n">echo</span> <span class="s2">&#34;Starting VNCServer for $USER&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">;;</span> 
</span></span><span class="line"><span class="cl">    <span class="n">stop</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">su</span> <span class="err">$</span><span class="n">USER</span> <span class="o">-</span><span class="n">c</span> <span class="s1">&#39;/usr/bin/vncserver -kill:1&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="n">echo</span> <span class="s2">&#34;VNCServer stopped&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">;;</span>
</span></span><span class="line"><span class="cl">    <span class="o">*</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">echo</span> <span class="s2">&#34;Usage: /etc/init.d/vncserver {start/stop}&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">exit</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">        <span class="p">;;</span>
</span></span><span class="line"><span class="cl">    <span class="n">esac</span>
</span></span><span class="line"><span class="cl">    <span class="n">exit</span> <span class="mi">0</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>代码2：自动连接热点
<ul>
<li>例程</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">    <span class="c1">#（wpa_supplicant.conf（文件名））</span>
</span></span><span class="line"><span class="cl">    <span class="n">country</span><span class="o">=</span><span class="n">CN</span>
</span></span><span class="line"><span class="cl">    <span class="n">ctrl_interface</span><span class="o">=</span><span class="n">DIR</span><span class="o">=/</span><span class="n">var</span><span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">wpa_supplicant</span><span class="err">，</span><span class="n">GROUP</span><span class="o">=</span><span class="n">netdev</span>
</span></span><span class="line"><span class="cl">    <span class="n">update_config</span><span class="o">=</span><span class="mi">1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">network</span><span class="o">=</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">ssid</span><span class="o">=</span><span class="s2">&#34;WiFi名称&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="n">psk</span><span class="o">=</span><span class="s2">&#34;WiFi密码&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="n">key_mgmt</span><span class="o">=</span><span class="n">WPA</span><span class="o">-</span><span class="n">PSK</span> 
</span></span><span class="line"><span class="cl">        <span class="n">priority</span><span class="o">=</span><span class="mi">1</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<h3 id="24-python开发环境配置venv虚拟环境">2.4 python开发环境配置(venv虚拟环境)
</h3><ul>
<li>查看当前python版本：python &ndash;version</li>
<li>创建虚拟环境：
<ul>
<li>(1). sudo apt-get update （更新apt工具）</li>
<li>(2). sudo apt-get install python3-venv（下载虚拟环境）</li>
<li>(3). python3 -m venv venv （先进入想要创建的虚拟环境的文件路径创建虚拟环境，最后为环境名称）</li>
<li>(4). source venv/bin/activate （激活虚拟环境）</li>
<li>(5). pip list（查看当前环境的python包）</li>
<li>(6). deactivate（退出当前的虚拟环境）</li>
</ul>
</li>
<li>创建虚拟环境venv时继承系统的包
<ul>
<li>方法 1：创建虚拟环境时继承系统包
<ul>
<li>python3 -m venv &ndash;system-site-packages myenv</li>
<li>解释1：myenv 是你的虚拟环境目录名（可自定义）。</li>
<li>解释2：&ndash;system-site-packages 会让虚拟环境继承系统中已安装的包。</li>
</ul>
</li>
<li>方法 2：对已存在的虚拟环境启用系统包
<ul>
<li>解释：如果虚拟环境已经创建，但没有继承系统包，可以通过修改虚拟环境的配置文件手动启用.</li>
<li>(1). 找到虚拟环境的 pyvenv.cfg 文件（通常在虚拟环境的根目录）：
<ul>
<li>cat myenv/pyvenv.cfg</li>
</ul>
</li>
<li>(2). 修改或添加以下行代码内容：
<ul>
<li>include-system-site-packages = true</li>
</ul>
</li>
<li>(3). 重新激活虚拟环境即可生效。</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="25-python开发">2.5 python开发
</h3><ul>
<li>在 Linux 中，要查看 Python 的 .py 文件内容，可以使用以下几种命令：
<ul>
<li>使用 cat 命令：
<ul>
<li>cat /path/to/your_python_file.py（cat 命令用于显示文件内容，将会在终端输出整个 .py 文件的内容）</li>
</ul>
</li>
<li>使用 less 命令：
<ul>
<li>less /path/to/your_python_file.py（less 命令可以按页显示文件内容，适用于较大的文件，可以使用箭头键和 PageUp/PageDown 键进行浏览）</li>
</ul>
</li>
<li>使用 more 命令：
<ul>
<li>more /path/to/your_python_file.py（more 命令也可以按页显示文件内容，与 less 类似，但在显示文件内容时的交互方式略有不同）</li>
</ul>
</li>
<li>使用 vim 或 nano 编辑器：(前提是需要先安装好有这个要用的编辑器,一般nano是自带会有的)
<ul>
<li>vim /path/to/your_python_file.py或nano /path/to/your_python_file.py（vim 和 nano 都是文本编辑器，但您也可以使用它们来查看 .py 文件的内容。在 vim 或 nano 中，您可以按 Esc 键退出查看模式，然后输入 :q 命令退出编辑器）</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="26-vim编辑器的使用">2.6 vim编辑器的使用
</h3><ul>
<li>初始模式：
<ul>
<li>:w 保存不退出</li>
<li>:q 不保存退出，一般与w搭配:wq保存并退出vim，回到命令行界面</li>
<li>:! 强制性操作，一般与q搭配:!q 为强制退出不保存</li>
<li>/ + 文本 查找字符串命令，查找多个匹配结果，可以n键向下查找，N向上查找。</li>
<li>set nu 显示行数。</li>
<li>set nonu 不显示行数</li>
<li>sp + 文件路径 再打开一个窗口，sp表示水平切分窗口，vs表示垂直切分窗口。</li>
<li>v 进入视图模式</li>
<li>i/a 进入编辑模式</li>
</ul>
</li>
<li>视图模式：
<ul>
<li>上、下、左、右键或者 k（上）、j（下）、h（左）、l（右） 命令进行光标移动并选中文字</li>
<li>选中文本后，d剪切 y复制 p粘贴</li>
<li>x 删除光标所在的单个字符</li>
<li>dd 删除一整行（相当于剪切），p 粘贴</li>
<li>yy 复制单行</li>
<li>u 撤销</li>
<li>Esc按键 退出视图模式回到初始模式</li>
</ul>
</li>
<li>编辑模式：
<ul>
<li>Esc按键 退出视图模式回到初始模式</li>
<li>其他按键则正常输入文本即可</li>
</ul>
</li>
</ul>
<h2 id="3-ros2学习笔记">3. ROS2学习笔记
</h2><blockquote class="alert alert-tip">
    <p>大部分是本人的学习笔记，学习视频主要是<a class="link" href="https://www.bilibili.com/video/BV1ky411e7hp/?spm_id_from=333.1387.favlist.content.click&amp;vd_source=b0f5272da83bbf0fd5569aa17bceb192"  target="_blank" rel="noopener"
    >鱼香ROS机器人</a>他的知识点和视频内容很详细，真的是在印证&quot;授人以鱼不如授人以渔&quot;。此外还会加上一些个人理解，希望能帮助加深理解，仅供学习参考！</p></blockquote>
<h3 id="31-ros2-run">3.1 ros2 run
</h3><blockquote class="alert alert-warn">
    <ul>
<li>(1). 命令<em>ros2 run</em>会从一个软件包中启动一个可执行文件：
<ul>
<li>ros2 run &lt;package_name&gt; &lt;executable_name&gt;</li>
</ul>
</li>
<li>(2). 解释：
<ul>
<li>eg：要运行turtlesim，请打开一个新的终端，并输入以下命令：
<ul>
<li>ros2 run turtlesim turtlesim_node</li>
</ul>
</li>
<li>turtlesim窗口将会打开</li>
<li>这里，包名是 使用 <strong>turtlesim</strong> ，可执行文件名是 <strong>turtlesim_node</strong></li>
<li>然而，我们还不知道节点名称。您可以使用 ros2 node list 命令查找节点名称。</li>
</ul>
</li>
</ul></blockquote>
<h3 id="32-ros2-node-list">3.2. ros2 node list
</h3><blockquote class="alert alert-error">
    <ul>
<li>(1). <em>ros2 node list</em> 命令将显示所有正在运行的节点的名称。当您想与节点进行交互或者系统运行多个节点时需要跟踪它们时，这特别有用。</li>
<li>(2). 解释： <br>
<ul>
<li>(A). 在另一个终端中打开新的终端，同时 turtlesim 仍在运行，请输入以下命令： <br>
<ul>
<li>ros2 node list <br></li>
</ul>
</li>
<li>(B). 终端将返回节点名称： <br>
<ul>
<li>/turtlesim <br></li>
</ul>
</li>
<li>(C). 再打开一个新的终端，并使用以下命令启动 teleop 节点： <br>
<ul>
<li>ros2 run turtlesim turtle_teleop_key <br></li>
<li>【在这里，我们再次引用了“turtlesim”软件包，但这次我们的目标是名为“turtle_teleop_key”的可执行文件】<br></li>
</ul>
</li>
<li>(D). 返回到之前运行ros2 node list的终端，再次运行该命令。你将会看到两个活动节点的名称：<br>
<ul>
<li>/turtlesim <br></li>
<li>/teleop_turtle <br></li>
</ul>
</li>
</ul>
</li>
</ul></blockquote>
<h3 id="33-重映射">3.3. 重映射
</h3><blockquote class="alert alert-warn">
    <ul>
<li>(1). <em>重映射</em>：允许你重新分配默认节点属性，如节点名称、话题名称、服务名称等，以自定义的值。在上一个教程中，你在<strong>turtle_teleop_key</strong>上使用了重映射来改变<strong>cmd_vel</strong>话题和目标节点为<strong>turtle2</strong>。</li>
<li>(2). 解释：
- (A). 现在，让我们重新分配 <strong>/turtlesim</strong> 节点的名称。在一个新的终端中运行以下命令：
- ros2 run turtlesim turtlesim_node &ndash;ros-args &ndash;remap __node:=my_turtle
- (B). 由于您再次调用<strong>ros2 run</strong> 启动了turtlesim，将会打开另一个turtlesim窗口。但是，现在如果您返回到之前运行<strong>ros2 node list</strong>的终端，并再次运行该命令，您将看到三个节点名称：
- /my_turtle
- /turtlesim
- /teleop_turtle</li>
</ul></blockquote>
<h3 id="34-ros2节点信息">3.4. ros2节点信息
</h3><blockquote class="alert alert-error">
    <p><strong>(既然您知道了节点的名称，您可以使用以下命令访问有关它们的更多信息)</strong></p>
<ul>
<li>ros2 node info &lt;node_name&gt;
<ul>
<li>(例). 要查看您最新的节点<strong>my_turtle</strong>，请运行以下命令：
<ul>
<li>ros2 node info /my_turtle</li>
<li><strong>ros2 node info</strong>返回订阅者、发布者、服务和动作的列表，即与该节点进行交互的ROS图连接。输出应该如下所示：</li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-plaintext" data-lang="plaintext"><span class="line"><span class="cl">/my_turtle
</span></span><span class="line"><span class="cl">Subscribers:
</span></span><span class="line"><span class="cl">  /parameter_events: rcl_interfaces/msg/ParameterEvent
</span></span><span class="line"><span class="cl">  /turtle1/cmd_vel: geometry_msgs/msg/Twist
</span></span><span class="line"><span class="cl">Publishers:
</span></span><span class="line"><span class="cl">  /parameter_events: rcl_interfaces/msg/ParameterEvent
</span></span><span class="line"><span class="cl">  /rosout: rcl_interfaces/msg/Log
</span></span><span class="line"><span class="cl">  /turtle1/color_sensor: turtlesim/msg/Color
</span></span><span class="line"><span class="cl">  /turtle1/pose: turtlesim/msg/Pose
</span></span><span class="line"><span class="cl">Service Servers:
</span></span><span class="line"><span class="cl">  /clear: std_srvs/srv/Empty
</span></span><span class="line"><span class="cl">  /kill: turtlesim/srv/Kill
</span></span><span class="line"><span class="cl">  /my_turtle/describe_parameters: rcl_interfaces/srv/DescribeParameters
</span></span><span class="line"><span class="cl">  /my_turtle/get_parameter_types: rcl_interfaces/srv/GetParameterTypes
</span></span><span class="line"><span class="cl">  /my_turtle/get_parameters: rcl_interfaces/srv/GetParameters
</span></span><span class="line"><span class="cl">  /my_turtle/list_parameters: rcl_interfaces/srv/ListParameters
</span></span><span class="line"><span class="cl">  /my_turtle/set_parameters: rcl_interfaces/srv/SetParameters
</span></span><span class="line"><span class="cl">  /my_turtle/set_parameters_atomically: rcl_interfaces/srv/SetParametersAtomically
</span></span><span class="line"><span class="cl">  /reset: std_srvs/srv/Empty
</span></span><span class="line"><span class="cl">  /spawn: turtlesim/srv/Spawn
</span></span><span class="line"><span class="cl">  /turtle1/set_pen: turtlesim/srv/SetPen
</span></span><span class="line"><span class="cl">  /turtle1/teleport_absolute: turtlesim/srv/TeleportAbsolute
</span></span><span class="line"><span class="cl">  /turtle1/teleport_relative: turtlesim/srv/TeleportRelative
</span></span><span class="line"><span class="cl">Service Clients: (none)
</span></span><span class="line"><span class="cl">Action Servers:
</span></span><span class="line"><span class="cl">  /turtle1/rotate_absolute: turtlesim/action/RotateAbsolute
</span></span><span class="line"><span class="cl">Action Clients: (none)
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul></blockquote>
<h3 id="35-编译运行c文件">3.5. 编译运行C++文件
</h3><blockquote class="alert alert-warn">
    <ul>
<li>
<p>(1). 先在目录下编写CMakeFiles.txt：</p>
<ul>
<li>示例：
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">    <span class="n">cmake_minimum_required</span><span class="p">(</span><span class="n">VERSION</span> <span class="mf">3.8</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">project</span><span class="p">(</span><span class="n">ros2_cpp</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">add_executable</span><span class="p">(</span><span class="n">ros2_cpp_node</span> <span class="n">ros2_cpp_node</span><span class="o">.</span><span class="n">cpp</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">find_package</span><span class="p">(</span><span class="n">rclcpp</span> <span class="n">REQUIRED</span><span class="p">)</span> <span class="c1"># 直接查找到对应的头文件和库文件</span>
</span></span><span class="line"><span class="cl">    <span class="n">message</span><span class="p">(</span><span class="n">STATUS</span> <span class="err">$</span><span class="p">{</span><span class="n">rclcpp_INCLUDE_DIRS</span><span class="p">})</span> <span class="c1">#头文件及rclcpp依赖的头文件</span>
</span></span><span class="line"><span class="cl">    <span class="n">message</span><span class="p">(</span><span class="n">STATUS</span> <span class="err">$</span><span class="p">{</span><span class="n">rclcpp_LIBRARIES</span><span class="p">})</span> <span class="c1">#库文件及rclcpp依赖的库文件</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   <span class="n">target_include_directories</span><span class="p">(</span><span class="n">ros2_cpp_node</span> <span class="n">PUBLIC</span> <span class="err">$</span><span class="p">{</span><span class="n">rclcpp_INCLUDE_DIRS</span><span class="p">})</span> <span class="c1">#头文件包好到ros2_cpp_node文件内</span>
</span></span><span class="line"><span class="cl">    <span class="n">target_link_libraries</span><span class="p">(</span><span class="n">ros2_cpp_node</span> <span class="err">$</span><span class="p">{</span><span class="n">rclcpp_LIBRARIES</span><span class="p">})</span> <span class="c1">#库文件链接到ros2_cpp_node文件内       </span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
</li>
<li>
<p>(2). 再在当前目录下运行终端命令：</p>
<ul>
<li>cmake .</li>
<li>make 【之后会生成一个可以执行文件为绿色的，直接终端输入既可运行】</li>
</ul>
</li>
</ul></blockquote>
<h3 id="36-创建功能包">3.6. 创建功能包
</h3><blockquote class="alert alert-error">
    <ul>
<li>先创建一个工作空间，然后再工作空间下新建src文件夹，进入src文件夹内运行：ros2 pkg create demo_python_topic &ndash;build-type ament_python &ndash;dependencies rclpy example_interfaces &ndash;license Apache-2.0【中间的&ndash;是可选项配置，有编译版本，添加的依赖，许可证，存放目录等等】</li>
<li>然后再回到工作空间文件夹内运行：colcon build</li>
<li>(✔️). 启用节点函数  setup.py添加：
<ul>
<li>&lsquo;python_NODE = demo_python_pkg.pyhon_node:main&rsquo;, 【生成可执行文件的名称以及包名和路径，函数名称】</li>
</ul>
</li>
<li>(✔️). 将需要导入的库加入到package.xml功能包清单文件的声明里面导入包，添加依赖信息：
<ul>
<li>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">  <span class="o">&lt;</span><span class="n">depend</span><span class="o">&gt;</span><span class="n">rclpy</span><span class="o">&lt;/</span><span class="n">depend</span><span class="o">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
</li>
<li>(✔️). 添加完之后需要开启构建功能包：colcon build 【终端直接执行命令，执行完之后是会根据你之前配置的调用函数拷贝复制一份一模一样的.py文件，然后运行调用的是复制过来的文件，不是原来的本身的文件，所以后续写了更新之后它的包调用的是你上一次拷贝的，不是你新写的】</li>
<li>(✔️). 修改环境变量：source install/setup.bash【此文件是创建时生成的】<br>
<ul>
<li>或者也可以手动添加这个环境变量：
<ul>
<li>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">  <span class="n">export</span> <span class="n">PYTHONPATH</span><span class="o">=/</span><span class="n">home</span><span class="o">/</span><span class="n">robot</span><span class="o">/</span><span class="n">chapt2</span><span class="o">/</span><span class="n">install</span><span class="o">/</span><span class="n">demo_python_pkg</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.12</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="p">:</span><span class="err">$</span><span class="n">PYTHONPATH</span> <span class="c1"># $PYTHONPATH表示原来的路径不变，缩写，然后加：前面加需要添加的路径</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
</li>
</ul>
</li>
</ul></blockquote>
<h3 id="37-其他">3.7. 其他
</h3><blockquote class="alert alert-warn">
    <ul>
<li>(A). <strong>echo</strong>
<ul>
<li>🔵查看当前ROS1/ROS2：echo $ROS_VERSION【中间有个下划线】</li>
<li>🔵查看当前ROS版本：echo $ROS_DISTRO</li>
</ul>
</li>
<li>(B). <strong>总的打印环境变量信息</strong>
<ul>
<li>🟡printenv
<ul>
<li>打印特定的信息，进行信息过滤：printenv | grep 想要打印的环境变量</li>
</ul>
</li>
</ul>
</li>
<li>(C). <strong>修改环境变量的文件位置</strong>
<ul>
<li>🟣export 环境变量名称=想要修改的文件位置（仅在当前终端临时修改成效，再另开还是原来的环境位置）</li>
</ul>
</li>
<li>(D). 在linux中，以.开头的文件或者文件夹，是隐藏文件
<ul>
<li>🔴(例). 启动自运行脚本：~/.bashrc</li>
</ul>
</li>
<li>(E). 安装python插件在vscode中的代码注释ctrl加左键，或者长放提示的注释形式</li>
<li>(F). 增加可执行文件的执行权限，白色为较低权限，绿色为较高权限可进行执行：
<ul>
<li>🟠chmod a+x 文件名</li>
</ul>
</li>
<li>(G). 查看节点的具体信息
<ul>
<li>⚫ros2 node info /节点名称</li>
</ul>
</li>
<li>打印目标话题的信息
<ul>
<li>ros2 topic echo 目标话题的名称</li>
</ul>
</li>
<li>查看话题的详细信息
<ul>
<li>ros2 topic info 目标话题的名称</li>
</ul>
</li>
<li>打印话题的某个接口的详细信息
<ul>
<li>ros2 interface show 接口名称</li>
</ul>
</li>
<li>发布一个话题
<ul>
<li>ros2 topic pub <strong>/turtle1/cmd_vel geometry_msgs/msg/Twist &ldquo;{linear: {x: 0.4, y: 0.0} , angular: {z: 0.0}}&rdquo;</strong>    【话题名称＋接口名称＋发布信息】<br>
<img src="/p/linux_learn/13.png"
	width="2032"
	height="1241"
	srcset="/p/linux_learn/13_hu_4d857d2b04241dca.png 480w, /p/linux_learn/13_hu_4d2b2a4ab2e07ded.png 1024w"
	loading="lazy"
	
		alt="示例效果图"
	
	
		class="gallery-image" 
		data-flex-grow="163"
		data-flex-basis="392px"
	
></li>
</ul>
</li>
<li>打印当前话题列表
<ul>
<li>ros2 topic list</li>
</ul>
</li>
</ul></blockquote>
<h3 id="38-工作空间workplace">3.8 工作空间(WorkPlace)
</h3><ul>
<li>创建使用工作空间
<ul>
<li>mkdir -p chapt2_ws/src 【-p表示创建目录下的文件夹】</li>
<li>mv demo_cpp_pkg/ chapt2_ws/src/【将要整合的包剪切移动到工作空间下】</li>
<li>mv demo_cpp_pkg/ chapt2_ws/src/</li>
<li>cd chapt2_ws/【进入工作空间再构建主，保证架构的清晰完整】</li>
<li>colcon build 【构建】</li>
<li>如果有功能包的依赖关系需要更改构建顺序就在对应需要依赖的package.xml文件内添加对应的依赖包既可，系统就会先编译构建被依赖的包
<ul>
<li><depend>被依赖的包名</depend></li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="39-python学习">3.9 Python学习
</h3><ul>
<li>简单的类和函数以及init方法的理解
<ul>
<li>示例代码：
<ul>
<li>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">  <span class="k">class</span> <span class="nc">PersonNode</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">      <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name_value</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span><span class="n">age_value</span><span class="p">:</span><span class="nb">int</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">          <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;PersonNode __init__方法被调用并且还添加了两个属性！&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="n">name_value</span>
</span></span><span class="line"><span class="cl">          <span class="bp">self</span><span class="o">.</span><span class="n">age</span><span class="o">=</span><span class="n">age_value</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="k">def</span> <span class="nf">eat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">food_name</span><span class="p">:</span><span class="nb">str</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">          <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">          方法：吃东西
</span></span></span><span class="line"><span class="cl"><span class="s2">          :food_name 食物名字
</span></span></span><span class="line"><span class="cl"><span class="s2">          &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">          <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">age</span><span class="si">}</span><span class="s2">岁，爱吃</span><span class="si">{</span><span class="n">food_name</span><span class="si">}</span><span class="s2">！&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">      <span class="n">node</span> <span class="o">=</span> <span class="n">PersonNode</span><span class="p">(</span><span class="s1">&#39;法外狂徒张三&#39;</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="n">node2</span> <span class="o">=</span> <span class="n">PersonNode</span><span class="p">(</span><span class="s1">&#39;法外狂徒里斯&#39;</span><span class="p">,</span><span class="mi">19</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="n">node</span><span class="o">.</span><span class="n">eat</span><span class="p">(</span><span class="s1">&#39;黄焖鸡米饭&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="n">node2</span><span class="o">.</span><span class="n">eat</span><span class="p">(</span><span class="s1">&#39;鱼香肉丝&#39;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"></code></pre></td></tr></table>
</div>
</div></li>
</ul>
</li>
<li>简单的继承思想
<ul>
<li>示例代码：
<ul>
<li>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">  <span class="kn">import</span> <span class="nn">rclpy</span>
</span></span><span class="line"><span class="cl">  <span class="kn">from</span> <span class="nn">rclpy.node</span> <span class="kn">import</span> <span class="n">Node</span> <span class="c1">#倒入Node类</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">class</span> <span class="nc">PersonNode</span><span class="p">(</span><span class="n">Node</span><span class="p">):</span><span class="c1">#此处的Node就是继承于导入的rclpy.node里面的Node类</span>
</span></span><span class="line"><span class="cl">      <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">node_name</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span><span class="n">name_value</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span><span class="n">age_value</span><span class="p">:</span><span class="nb">int</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">          <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;PersonNode __init__方法被调用并且还添加了两个属性！&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">node_name</span><span class="p">)</span> <span class="c1">#初始化节点</span>
</span></span><span class="line"><span class="cl">          <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="n">name_value</span>
</span></span><span class="line"><span class="cl">          <span class="bp">self</span><span class="o">.</span><span class="n">age</span><span class="o">=</span><span class="n">age_value</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="k">def</span> <span class="nf">eat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">food_name</span><span class="p">:</span><span class="nb">str</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">          <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">          方法：吃东西
</span></span></span><span class="line"><span class="cl"><span class="s2">          :food_name 食物名字
</span></span></span><span class="line"><span class="cl"><span class="s2">          &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">          <span class="c1"># print(f&#34;{self.name},{self.age}岁，爱吃{food_name}！&#34;)</span>
</span></span><span class="line"><span class="cl">          <span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">age</span><span class="si">}</span><span class="s2">岁，爱吃</span><span class="si">{</span><span class="n">food_name</span><span class="si">}</span><span class="s2">！&#34;</span><span class="p">)</span> <span class="c1">#将内容添加到ros日志里面并且打印</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">      <span class="n">rclpy</span><span class="o">.</span><span class="n">init</span><span class="p">()</span> <span class="c1">#使用ros2前需要执行init初始化资源配置</span>
</span></span><span class="line"><span class="cl">      <span class="n">node</span> <span class="o">=</span> <span class="n">PersonNode</span><span class="p">(</span><span class="s1">&#39;zhangsan_node&#39;</span><span class="p">,</span><span class="s1">&#39;法外狂徒张三&#39;</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="n">node</span><span class="o">.</span><span class="n">eat</span><span class="p">(</span><span class="s1">&#39;黄焖鸡米饭&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="n">rclpy</span><span class="o">.</span><span class="n">spin</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> <span class="c1">#收集节点数据</span>
</span></span><span class="line"><span class="cl">      <span class="n">rclpy</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span> <span class="c1">#关闭节点</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
</li>
<li>多线程及回调函数
<ul>
<li>示例代码：</li>
<li>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">  <span class="kn">import</span> <span class="nn">threading</span>
</span></span><span class="line"><span class="cl">  <span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">class</span> <span class="nc">Download</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">      <span class="k">def</span> <span class="nf">download</span><span class="p">(</span><span class="n">sel</span><span class="p">,</span><span class="n">url</span><span class="p">,</span><span class="n">callback_word_count</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">          <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;线程：</span><span class="si">{</span><span class="n">threading</span><span class="o">.</span><span class="n">get_ident</span><span class="p">()</span><span class="si">}</span><span class="s2">开始下载：</span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">          <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">          <span class="n">response</span><span class="o">.</span><span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span> <span class="c1">#给请求的结果一个编码</span>
</span></span><span class="line"><span class="cl">          <span class="n">callback_word_count</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span> <span class="c1">#调用回调函数</span>
</span></span><span class="line"><span class="cl">          <span class="c1">#pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="k">def</span> <span class="nf">start_download</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">url</span><span class="p">,</span><span class="n">callback_word_count</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">          <span class="n">thread</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">download</span><span class="p">,</span><span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="n">callback_word_count</span><span class="p">))</span> <span class="c1">#创建一个新的线程  target目标函数，args需要传入的参数</span>
</span></span><span class="line"><span class="cl">          <span class="n">thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span> <span class="c1">#启动线程</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">          <span class="c1"># pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">def</span> <span class="nf">world_count</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="n">result</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">      普通的函数，用于回调
</span></span></span><span class="line"><span class="cl"><span class="s2">      &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="si">}</span><span class="s2">-&gt;</span><span class="si">{</span><span class="n">result</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">      <span class="n">download</span> <span class="o">=</span> <span class="n">Download</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">      <span class="n">download</span><span class="o">.</span><span class="n">start_download</span><span class="p">(</span><span class="s1">&#39;url网址&#39;</span><span class="p">,</span><span class="n">world_count</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="n">download</span><span class="o">.</span><span class="n">start_download</span><span class="p">(</span><span class="s1">&#39;url网址&#39;</span><span class="p">,</span><span class="n">world_count</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="n">download</span><span class="o">.</span><span class="n">start_download</span><span class="p">(</span><span class="s1">&#39;url网址&#39;</span><span class="p">,</span><span class="n">world_count</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="310-c学习">3.10 C++学习
</h3><ul>
<li>C++ vscode的扩展遇到include报错找不到路径就在他扩展配置中添加类似：/opt/ros/jazzy/include/**</li>
<li>依据类似的面向对象编程原理，代码示例如下：
<ul>
<li>示例代码：
<ul>
<li>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl">  <span class="cp">#include</span> <span class="cpf">&#34;rclcpp/rclcpp.hpp&#34;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl">  <span class="c1">// 定义一个PersionNode的类并且继承rclcpp的Node作为父类
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">class</span> <span class="nc">PersonNode</span> <span class="o">:</span> <span class="k">public</span> <span class="n">rclcpp</span><span class="o">::</span><span class="n">Node</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// 声明
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">name_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="kt">int</span> <span class="n">age_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">      <span class="n">PersonNode</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">node_name</span><span class="p">,</span> <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">name</span><span class="p">,</span> <span class="k">const</span> <span class="kt">int</span> <span class="o">&amp;</span><span class="n">age</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="o">:</span> <span class="n">Node</span><span class="p">(</span><span class="n">node_name</span><span class="p">)</span> <span class="cm">/*调用父类的构造函数，等同于python中的 super().__init__(),传入节点的名称作为参数*/</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="k">this</span><span class="o">-&gt;</span><span class="n">name_</span> <span class="o">=</span> <span class="n">name</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">          <span class="k">this</span><span class="o">-&gt;</span><span class="n">age_</span> <span class="o">=</span> <span class="n">age</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="kt">void</span> <span class="nf">eat</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">food_name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="n">RCLCPP_INFO</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">get_logger</span><span class="p">(),</span> <span class="s">&#34;我是%s,%d岁了,爱吃%s&#34;</span><span class="p">,</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">name_</span><span class="p">.</span><span class="n">c_str</span><span class="p">(),</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">age_</span><span class="p">,</span> <span class="n">food_name</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">      <span class="p">};</span>
</span></span><span class="line"><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">rclcpp</span><span class="o">::</span><span class="n">init</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="k">auto</span> <span class="n">node</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">PersonNode</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&#34;persion_node&#34;</span><span class="p">,</span> <span class="s">&#34;小过&#34;</span><span class="p">,</span> <span class="mi">20</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="n">node</span><span class="o">-&gt;</span><span class="n">eat</span><span class="p">(</span><span class="s">&#34;黄焖鸡米饭&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="n">rclcpp</span><span class="o">::</span><span class="n">spin</span><span class="p">(</span><span class="n">node</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="n">rclcpp</span><span class="o">::</span><span class="n">shutdown</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"></code></pre></td></tr></table>
</div>
</div></li>
<li>将代码添加到src/目录下创建的person_node.cpp文件内，编写好后再到CmkeList.txt文件内添加指定输出的可执行文件名和需要连接的包名以及执行编译</li>
<li>最终进入到CmkeList.txt目录结构下（例如图片中的目录应进入chart2_ws/）运行
<ul>
<li>colcon build #编译</li>
<li>source install/setup.bash</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img src="/p/linux_learn/11.png"
	width="2024"
	height="1179"
	srcset="/p/linux_learn/11_hu_b2d9078a7d21032e.png 480w, /p/linux_learn/11_hu_7886eff87a9378b9.png 1024w"
	loading="lazy"
	
		alt="目录框架图"
	
	
		class="gallery-image" 
		data-flex-grow="171"
		data-flex-basis="412px"
	
></p>
<p><img src="/p/linux_learn/10.png"
	width="2037"
	height="1209"
	srcset="/p/linux_learn/10_hu_1e7c8f185de0c4cd.png 480w, /p/linux_learn/10_hu_f4f4565c3a919bac.png 1024w"
	loading="lazy"
	
		alt="CmkeList.txt内容示意图"
	
	
		class="gallery-image" 
		data-flex-grow="168"
		data-flex-basis="404px"
	
></p>
<ul>
<li>C++新特性
<ul>
<li>auto自动类型推导，示例代码如下：
<ul>
<li>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl">  <span class="cp">#include</span> <span class="cpf">&#34;iostream&#34;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="c1">//auto 的自动类型推导
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="k">auto</span> <span class="n">xn</span> <span class="o">=</span> <span class="mi">2</span> <span class="p">;</span> <span class="c1">//int xn = 2;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="k">auto</span> <span class="n">yn</span> <span class="o">=</span> <span class="mf">3.14f</span><span class="p">;</span> <span class="c1">//float yn = 3.1415;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="k">auto</span> <span class="n">zn</span> <span class="o">=</span> <span class="sc">&#39;a&#39;</span><span class="p">;</span><span class="c1">//char zn = &#39;a&#39;;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="o">&lt;&lt;</span><span class="n">xn</span><span class="o">&lt;&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="o">&lt;&lt;</span><span class="n">yn</span><span class="o">&lt;&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="o">&lt;&lt;</span><span class="n">zn</span><span class="o">&lt;&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"></code></pre></td></tr></table>
</div>
</div></li>
<li>共享指针
<ul>
<li>使用共享指针不要用重复新增内存地址，并且可以自动回收不会造成内存泄漏，例如下面的make_shared例子：
<ul>
<li>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl">  <span class="cp">#include</span> <span class="cpf">&#34;iostream&#34;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>  <span class="cp">#include</span> <span class="cpf">&#34;memory&#34;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">auto</span> <span class="n">p1</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&#34;This is a str.&#34;</span><span class="p">);</span> <span class="c1">// std::make_shared&lt;数据类型/类&gt;（参数）；返回值，对应的共享指针 std::shared_ptr&lt;std::string&gt; 写成 auto
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">&#34;p1的引用计数&#34;</span><span class="o">&lt;&lt;</span> <span class="n">p1</span><span class="p">.</span><span class="n">use_count</span><span class="p">()</span><span class="o">&lt;&lt;</span><span class="s">&#34;,指向内存地址：&#34;</span><span class="o">&lt;&lt;</span><span class="n">p1</span><span class="p">.</span><span class="n">get</span><span class="p">()</span><span class="o">&lt;&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span> <span class="c1">// 1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">      <span class="k">auto</span> <span class="n">p2</span> <span class="o">=</span><span class="n">p1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">&#34;p1的引用计数&#34;</span><span class="o">&lt;&lt;</span> <span class="n">p1</span><span class="p">.</span><span class="n">use_count</span><span class="p">()</span><span class="o">&lt;&lt;</span><span class="s">&#34;,指向内存地址：&#34;</span><span class="o">&lt;&lt;</span><span class="n">p1</span><span class="p">.</span><span class="n">get</span><span class="p">()</span><span class="o">&lt;&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span> <span class="c1">// 2
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">&#34;p2的引用计数&#34;</span><span class="o">&lt;&lt;</span> <span class="n">p2</span><span class="p">.</span><span class="n">use_count</span><span class="p">()</span><span class="o">&lt;&lt;</span><span class="s">&#34;,指向内存地址：&#34;</span><span class="o">&lt;&lt;</span><span class="n">p2</span><span class="p">.</span><span class="n">get</span><span class="p">()</span><span class="o">&lt;&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span> <span class="c1">// 2
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">      <span class="n">p1</span><span class="p">.</span><span class="n">reset</span><span class="p">();</span> <span class="c1">//释放引用，不指向“This is a str.”所在内存
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">&#34;p1的引用计数&#34;</span><span class="o">&lt;&lt;</span> <span class="n">p1</span><span class="p">.</span><span class="n">use_count</span><span class="p">()</span><span class="o">&lt;&lt;</span><span class="s">&#34;,指向内存地址：&#34;</span><span class="o">&lt;&lt;</span><span class="n">p1</span><span class="p">.</span><span class="n">get</span><span class="p">()</span><span class="o">&lt;&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span> <span class="c1">// 0
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">&#34;p2的引用计数&#34;</span><span class="o">&lt;&lt;</span> <span class="n">p2</span><span class="p">.</span><span class="n">use_count</span><span class="p">()</span><span class="o">&lt;&lt;</span><span class="s">&#34;,指向内存地址：&#34;</span><span class="o">&lt;&lt;</span><span class="n">p2</span><span class="p">.</span><span class="n">get</span><span class="p">()</span><span class="o">&lt;&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span> <span class="c1">// 2-1=1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">      <span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">&#34;p2的指向内存地址：&#34;</span><span class="o">&lt;&lt;</span><span class="n">p2</span><span class="o">-&gt;</span><span class="n">c_str</span><span class="p">()</span><span class="o">&lt;&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span> <span class="c1">// 调用成员方法  This is a str.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"></code></pre></td></tr></table>
</div>
</div></li>
</ul>
</li>
<li>匿名函数
<ul>
<li>
<p>换一种语法的函数 下面lambda函数示例代码：</p>
<ul>
<li>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl">  <span class="cp">#include</span> <span class="cpf">&#34;iostream&#34;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>  <span class="cp">#include</span> <span class="cpf">&lt;algorithm&gt;</span><span class="cp">    
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">auto</span> <span class="n">add</span> <span class="o">=</span> <span class="p">[](</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span><span class="kt">int</span> <span class="n">b</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">int</span> <span class="p">{</span><span class="k">return</span> <span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="p">;};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="kt">int</span> <span class="n">sum</span> <span class="o">=</span> <span class="n">add</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span><span class="mi">50</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="k">auto</span> <span class="n">print_sum</span> <span class="o">=</span> <span class="p">[</span><span class="n">sum</span><span class="p">]()</span> <span class="o">-&gt;</span> <span class="kt">void</span> <span class="c1">//此处直接将sum内容调用过来
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="o">&lt;&lt;</span><span class="n">sum</span><span class="o">&lt;&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl">      <span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="n">print_sum</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>函数包装器，理解下面示例代码：</p>
<ul>
<li>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl">  <span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>  <span class="cp">#include</span> <span class="cpf">&lt;functional&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl">  <span class="c1">// 自由函数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">void</span> <span class="nf">save_with_free_fun</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">file_name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;自由函数：&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">file_name</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// 成员函数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">class</span> <span class="nc">FileSave</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">  <span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">      <span class="n">FileSave</span><span class="p">(</span><span class="cm">/* args */</span><span class="p">)</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="o">~</span><span class="n">FileSave</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="kt">void</span> <span class="nf">save_with_member_fun</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">file_name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;成员方法：&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">file_name</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="p">};</span>
</span></span><span class="line"><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">FileSave</span> <span class="n">file_save</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="c1">// Lambda函数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="k">auto</span> <span class="n">save_with_lambda_fun</span> <span class="o">=</span> <span class="p">[](</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">file_name</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">void</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Lambda 函数：&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">file_name</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="c1">//常见的普通函数调用
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">      <span class="c1">// save_with_lambda_fun(&#34;file.txt&#34;);           // Lambda函数的调用
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="c1">// file_save.save_with_member_fun(&#34;file.txt&#34;); // 成员函数的调用
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="c1">// save_with_free_fun(&#34;file.txt&#34;);             // 自由函数的调用
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">      <span class="c1">//使用函数包装器之后的：
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">      <span class="n">std</span><span class="o">::</span><span class="n">function</span><span class="o">&lt;</span><span class="kt">void</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">save1</span><span class="o">=</span><span class="n">save_with_free_fun</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="n">std</span><span class="o">::</span><span class="n">function</span><span class="o">&lt;</span><span class="kt">void</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">save2</span><span class="o">=</span><span class="n">save_with_lambda_fun</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="c1">//成员函数，放入包装器
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="n">std</span><span class="o">::</span><span class="n">function</span><span class="o">&lt;</span><span class="kt">void</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">save3</span><span class="o">=</span><span class="n">std</span><span class="o">::</span><span class="n">bind</span><span class="p">(</span><span class="o">&amp;</span><span class="n">FileSave</span><span class="o">::</span><span class="n">save_with_member_fun</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="o">&amp;</span><span class="n">file_save</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">placeholders</span><span class="o">::</span><span class="n">_1</span><span class="p">);</span> <span class="c1">//保护类的其他方法不被调用
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">      <span class="c1">//统一的调用方法
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="n">save1</span><span class="p">(</span><span class="s">&#34;file.txt&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="n">save2</span><span class="p">(</span><span class="s">&#34;file.txt&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="n">save3</span><span class="p">(</span><span class="s">&#34;file.txt&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"></code></pre></td></tr></table>
</div>
</div></li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="311-多线程以及回调函数">3.11 多线程以及回调函数
</h3><p><img src="/p/linux_learn/12.png"
	width="1030"
	height="691"
	srcset="/p/linux_learn/12_hu_c12a5fe78c860f76.png 480w, /p/linux_learn/12_hu_56508aaa6df21af8.png 1024w"
	loading="lazy"
	
		alt="函数包装器"
	
	
		class="gallery-image" 
		data-flex-grow="149"
		data-flex-basis="357px"
	
></p>
<ul>
<li>C++具体(有关http服务的请求等部分较为复杂，详细请看<a class="link" href="https://www.bilibili.com/video/BV18mWjeEEXS/?spm_id_from=333.1391.0.0&amp;vd_source=b0f5272da83bbf0fd5569aa17bceb192"  target="_blank" rel="noopener"
    >ROS2 小鱼</a>) 【打开http服务：python3 -m http.server】
<ul>
<li>示例代码：
<ul>
<li>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl">  <span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>  <span class="cp">#include</span> <span class="cpf">&lt;thread&gt;</span><span class="cp"> </span><span class="c1">//多线程
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="cp">#include</span> <span class="cpf">&lt;chrono&gt;</span><span class="cp">  </span><span class="c1">//时间相关
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="cp">#include</span> <span class="cpf">&lt;functional&gt;</span><span class="cp"> </span><span class="c1">//函数包装器
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="cp">#include</span> <span class="cpf">&#34;cpp-httplib/httplib.h&#34;</span><span class="cp"> </span><span class="c1">//下载相关
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="k">class</span> <span class="nc">Download</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">      <span class="cm">/* data */</span>
</span></span><span class="line"><span class="cl">  <span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">      <span class="kt">void</span> <span class="n">download</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">host</span><span class="p">,</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">path</span><span class="p">,</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">function</span><span class="o">&lt;</span><span class="kt">void</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="p">,</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="p">)</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">callback_word_count</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">&#34;线程&#34;</span><span class="o">&lt;&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">this_thread</span><span class="o">::</span><span class="n">get_id</span><span class="p">()</span><span class="o">&lt;&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">          <span class="n">httplib</span><span class="o">::</span><span class="n">Client</span> <span class="n">client</span><span class="p">(</span><span class="n">host</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">          <span class="k">auto</span> <span class="n">response</span><span class="o">=</span><span class="n">client</span><span class="p">.</span><span class="n">Get</span><span class="p">(</span><span class="n">path</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">          <span class="k">if</span><span class="p">(</span><span class="n">response</span><span class="o">&amp;&amp;</span><span class="n">response</span><span class="o">-&gt;</span><span class="n">status</span><span class="o">==</span><span class="mi">200</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="p">{</span>
</span></span><span class="line"><span class="cl">              <span class="n">callback_word_count</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="n">response</span><span class="o">-&gt;</span><span class="n">body</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">          <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">};</span>
</span></span><span class="line"><span class="cl">      <span class="kt">void</span> <span class="nf">start_download</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">host</span><span class="p">,</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">path</span><span class="p">,</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">function</span><span class="o">&lt;</span><span class="kt">void</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="p">,</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="p">)</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">callback_word_count</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="k">auto</span> <span class="n">download_fun</span><span class="o">=</span><span class="n">std</span><span class="o">::</span><span class="n">bind</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Download</span><span class="o">::</span><span class="n">download</span><span class="p">,</span><span class="k">this</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">placeholders</span><span class="o">::</span><span class="n">_1</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">placeholders</span><span class="o">::</span><span class="n">_2</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">placeholders</span><span class="o">::</span><span class="n">_3</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">          <span class="n">std</span><span class="o">::</span><span class="kr">thread</span> <span class="kr">thread</span><span class="p">(</span><span class="n">download_fun</span><span class="p">,</span><span class="n">host</span><span class="p">,</span><span class="n">path</span><span class="p">,</span><span class="n">callback_word_count</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">          <span class="kr">thread</span><span class="p">.</span><span class="n">detach</span><span class="p">();</span> <span class="c1">//线程分离！
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="p">};</span>    
</span></span><span class="line"><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">auto</span> <span class="n">d</span><span class="o">=</span><span class="n">Download</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">      <span class="k">auto</span> <span class="n">word_count</span> <span class="o">=</span><span class="p">[](</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">path</span><span class="p">,</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">result</span><span class="p">)</span> <span class="o">-&gt;</span><span class="kt">void</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">&#34;下载完成&#34;</span><span class="o">&lt;&lt;</span><span class="n">path</span><span class="o">&lt;&lt;</span><span class="s">&#34;:&#34;</span><span class="o">&lt;&lt;</span><span class="n">result</span><span class="p">.</span><span class="n">length</span><span class="p">()</span><span class="o">&lt;&lt;</span><span class="s">&#34;-&gt;&#34;</span><span class="o">&lt;&lt;</span><span class="n">result</span><span class="p">.</span><span class="n">substr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span><span class="o">&lt;&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="n">d</span><span class="p">.</span><span class="n">start_download</span><span class="p">(</span><span class="s">&#34;host域名&#34;</span><span class="p">,</span><span class="s">&#34;path1地址&#34;</span><span class="p">,</span><span class="n">word_count</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="n">d</span><span class="p">.</span><span class="n">start_download</span><span class="p">(</span><span class="s">&#34;host域名&#34;</span><span class="p">,</span><span class="s">&#34;path2地址&#34;</span><span class="p">,</span><span class="n">word_count</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="n">d</span><span class="p">.</span><span class="n">start_download</span><span class="p">(</span><span class="s">&#34;host域名&#34;</span><span class="p">,</span><span class="s">&#34;path3地址&#34;</span><span class="p">,</span><span class="n">word_count</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="n">std</span><span class="o">::</span><span class="n">this_thread</span><span class="o">::</span><span class="n">sleep_for</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">milliseconds</span><span class="p">(</span><span class="mi">1000</span><span class="o">*</span><span class="mi">100</span><span class="p">));</span><span class="c1">//休眠10s
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"></code></pre></td></tr></table>
</div>
</div></li>
</ul>
</li>
</ul>
<h3 id="312-话题">3.12 话题
</h3><ul>
<li>话题的发布
<ul>
<li>示例python节点代码发布话题：
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">   <span class="kn">import</span> <span class="nn">rclpy</span>
</span></span><span class="line"><span class="cl">   <span class="kn">from</span> <span class="nn">rclpy.node</span> <span class="kn">import</span> <span class="n">Node</span>
</span></span><span class="line"><span class="cl">   <span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl">   <span class="kn">from</span> <span class="nn">example_interfaces.msg</span> <span class="kn">import</span> <span class="n">String</span>
</span></span><span class="line"><span class="cl">   <span class="kn">from</span> <span class="nn">queue</span> <span class="kn">import</span>  <span class="n">Queue</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   <span class="k">class</span> <span class="nc">NovelPuNode</span><span class="p">(</span><span class="n">Node</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">       <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">node_name</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">           <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">node_name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">           <span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">node_name</span><span class="si">}</span><span class="s2">,启动！&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">           <span class="bp">self</span><span class="o">.</span><span class="n">novel_queue_</span><span class="o">=</span><span class="n">Queue</span><span class="p">()</span> <span class="c1">#创建队列 放在前面</span>
</span></span><span class="line"><span class="cl">           <span class="bp">self</span><span class="o">.</span><span class="n">novel_publisher_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_publisher</span><span class="p">(</span><span class="n">String</span><span class="p">,</span><span class="s1">&#39;novel&#39;</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">           <span class="bp">self</span><span class="o">.</span><span class="n">create_timer</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">timer_callback</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">       <span class="k">def</span> <span class="nf">timer_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">           <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">novel_queue_</span><span class="o">.</span><span class="n">qsize</span><span class="p">()</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">               <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">novel_queue_</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">               <span class="n">msg</span><span class="o">=</span><span class="n">String</span><span class="p">()</span> <span class="c1">#组装</span>
</span></span><span class="line"><span class="cl">               <span class="n">msg</span><span class="o">.</span><span class="n">data</span><span class="o">=</span><span class="n">line</span>
</span></span><span class="line"><span class="cl">               <span class="bp">self</span><span class="o">.</span><span class="n">novel_publisher_</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">               <span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;发布了：</span><span class="si">{</span><span class="n">msg</span><span class="si">}</span><span class="s2"> 这条信息！&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">       <span class="k">def</span> <span class="nf">download</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">url</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">           <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span> <span class="c1">#发送开始请求</span>
</span></span><span class="line"><span class="cl">           <span class="n">response</span><span class="o">.</span><span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span> <span class="c1">#给请求的结果一个编码</span>
</span></span><span class="line"><span class="cl">           <span class="n">text</span> <span class="o">=</span><span class="n">response</span><span class="o">.</span><span class="n">text</span>
</span></span><span class="line"><span class="cl">           <span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;下载</span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">           <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">text</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span> <span class="c1">#获取到每一行的数据存储到队列中 按行分割</span>
</span></span><span class="line"><span class="cl">               <span class="bp">self</span><span class="o">.</span><span class="n">novel_queue_</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">       <span class="n">rclpy</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">       <span class="n">node</span> <span class="o">=</span> <span class="n">NovelPuNode</span><span class="p">(</span><span class="s1">&#39;novel_pub&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">       <span class="n">node</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="s1">&#39;http://0.0.0.0:8000/novel1.txt&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">       <span class="n">rclpy</span><span class="o">.</span><span class="n">spin</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">       <span class="n">rclpy</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
</li>
<li>订阅话题
<ul>
<li>python示例代码：
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">   <span class="kn">import</span> <span class="nn">espeakng</span>
</span></span><span class="line"><span class="cl">   <span class="kn">import</span> <span class="nn">rclpy</span>
</span></span><span class="line"><span class="cl">   <span class="kn">from</span> <span class="nn">rclpy.node</span> <span class="kn">import</span> <span class="n">Node</span>
</span></span><span class="line"><span class="cl">   <span class="kn">from</span> <span class="nn">example_interfaces.msg</span> <span class="kn">import</span> <span class="n">String</span>
</span></span><span class="line"><span class="cl">   <span class="kn">from</span> <span class="nn">queue</span> <span class="kn">import</span>  <span class="n">Queue</span>
</span></span><span class="line"><span class="cl">   <span class="kn">import</span> <span class="nn">threading</span>
</span></span><span class="line"><span class="cl">   <span class="kn">import</span> <span class="nn">time</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   <span class="k">class</span> <span class="nc">NovelSubNode</span><span class="p">(</span><span class="n">Node</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">       <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">node_name</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">           <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">node_name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">           <span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">node_name</span><span class="si">}</span><span class="s2">,启动！&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">           <span class="bp">self</span><span class="o">.</span><span class="n">novels_queue_</span> <span class="o">=</span><span class="n">Queue</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">           <span class="bp">self</span><span class="o">.</span><span class="n">novel_subscriber_</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">create_subscription</span><span class="p">(</span><span class="n">String</span><span class="p">,</span><span class="s1">&#39;novel&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">novel_callback</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">           <span class="bp">self</span><span class="o">.</span><span class="n">speech_thread_</span> <span class="o">=</span><span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">speake_thread</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">           <span class="bp">self</span><span class="o">.</span><span class="n">speech_thread_</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">       <span class="k">def</span> <span class="nf">novel_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">msg</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">           <span class="bp">self</span><span class="o">.</span><span class="n">novels_queue_</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">       <span class="k">def</span> <span class="nf">speake_thread</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">           <span class="n">speaker</span> <span class="o">=</span><span class="n">espeakng</span><span class="o">.</span><span class="n">Speaker</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">           <span class="n">speaker</span><span class="o">.</span><span class="n">voice</span><span class="o">=</span><span class="s1">&#39;zh-yue&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">           <span class="k">while</span> <span class="n">rclpy</span><span class="o">.</span><span class="n">ok</span><span class="p">():</span> <span class="c1">#检测当前ROS上下文是否OK</span>
</span></span><span class="line"><span class="cl">               <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">novels_queue_</span><span class="o">.</span><span class="n">qsize</span><span class="p">()</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                   <span class="n">text</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">novels_queue_</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                   <span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;朗诵：</span><span class="si">{</span><span class="n">text</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                   <span class="n">speaker</span><span class="o">.</span><span class="n">say</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="c1">#说</span>
</span></span><span class="line"><span class="cl">                   <span class="n">speaker</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span> <span class="c1">#等他说完</span>
</span></span><span class="line"><span class="cl">               <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                   <span class="c1"># 让当前进程休眠1s</span>
</span></span><span class="line"><span class="cl">                   <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">       <span class="n">rclpy</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">       <span class="n">node</span> <span class="o">=</span> <span class="n">NovelSubNode</span><span class="p">(</span><span class="s1">&#39;novel_sub&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">       <span class="n">rclpy</span><span class="o">.</span><span class="n">spin</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">       <span class="n">rclpy</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>安装espeakng过程中遇到的问题：（建议是直接创建一个合适的虚拟环境venv然后下载你后续需要的库，不要用全局系统）
<ul>
<li>直接先进入到你想要放置虚拟环境的文件中，建议是直接放到~/目录下，然后运行：</li>
<li>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">  <span class="c1"># 使用全局Python创建虚拟环境，并继承系统包</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># /bin/python3 -m venv --system-site-packages ~/mvenv</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>随后在你的vscode中替换为你新建的环境：</li>
<li>之后你缺少哪个库，就在这个虚拟环境下直接：(pip install 库名 ) 既可</li>
<li>最终的编译后使用ros2 run 时需要提前在本工作空间新建一个.sh脚本文件：</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">    <span class="c1">#!/bin/bash</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># 激活虚拟环境</span>
</span></span><span class="line"><span class="cl">    <span class="nb">source</span> ~/mvenv/bin/activate
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># 配置 ROS2 环境 需要根据自己的系统来配置</span>
</span></span><span class="line"><span class="cl">    <span class="nb">source</span> /opt/ros/jazzy/setup.bash
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># 配置你的工作空间</span>
</span></span><span class="line"><span class="cl">    <span class="nb">source</span> ~/chapt3/topic_ws/install/setup.bash
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># 把虚拟环境的 Python 路径加入到 ROS2 的 Python 路径中 后续其他工程或者工作空间的python中需要ros2调用自己创建的虚拟环境的第三方库时直接修该这段中的对应虚拟环境的名词/位置即可</span>
</span></span><span class="line"><span class="cl">    <span class="nb">export</span> <span class="nv">PYTHONPATH</span><span class="o">=</span><span class="nv">$PYTHONPATH</span>:/home/robot/mvenv/lib/python3.12/site-packages
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;ROS2 + Python 虚拟环境已配置完成！&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>然后正常colcon build和source install/setup.bash既可运行ros2 run</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img src="/p/linux_learn/17.png"
	width="2037"
	height="1197"
	srcset="/p/linux_learn/17_hu_8d4b001e269b078a.png 480w, /p/linux_learn/17_hu_b84ab974187cb3a6.png 1024w"
	loading="lazy"
	
		alt="示意图"
	
	
		class="gallery-image" 
		data-flex-grow="170"
		data-flex-basis="408px"
	
></p>
<ul>
<li>C++发布话题控制小海龟运动
<ul>
<li>示例代码(仅发布话题)：
<ul>
<li>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl">  <span class="cp">#include</span> <span class="cpf">&#34;rclcpp/rclcpp.hpp&#34;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>  <span class="cp">#include</span> <span class="cpf">&#34;geometry_msgs/msg/twist.hpp&#34;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>  <span class="cp">#include</span> <span class="cpf">&lt;chrono&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl">  <span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono_literals</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">class</span> <span class="nc">TurtlrCircleNode</span><span class="o">:</span><span class="k">public</span> <span class="n">rclcpp</span><span class="o">::</span><span class="n">Node</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">      <span class="n">rclcpp</span><span class="o">::</span><span class="n">TimerBase</span><span class="o">::</span><span class="n">SharedPtr</span> <span class="n">timer_</span><span class="p">;</span> <span class="c1">//创建计时器
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="n">rclcpp</span><span class="o">::</span><span class="n">Publisher</span><span class="o">&lt;</span><span class="n">geometry_msgs</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">Twist</span><span class="o">&gt;::</span><span class="n">SharedPtr</span> <span class="n">publisher_</span><span class="p">;</span> <span class="c1">//发布者的智能指针
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">      <span class="k">explicit</span> <span class="n">TurtlrCircleNode</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">node_name</span><span class="p">)</span><span class="o">:</span><span class="n">Node</span><span class="p">(</span><span class="n">node_name</span><span class="p">)</span> <span class="c1">//加入explicit关键字是防止类进行单参数隐式转换 此处只有一个参数可以被直接使用赋值构造，但是不要允许这样发生，提高代码的可维护性
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="n">publisher_</span><span class="o">=</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">create_publisher</span><span class="o">&lt;</span><span class="n">geometry_msgs</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">Twist</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&#34;/turtle1/cmd_vel&#34;</span><span class="p">,</span><span class="mi">10</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">          <span class="n">timer_</span><span class="o">=</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">create_wall_timer</span><span class="p">(</span><span class="mi">1000</span><span class="n">ms</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">bind</span><span class="p">(</span><span class="o">&amp;</span><span class="n">TurtlrCircleNode</span><span class="o">::</span><span class="n">timer_callback</span><span class="p">,</span><span class="k">this</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="kt">void</span> <span class="nf">timer_callback</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="k">auto</span> <span class="n">msg</span><span class="o">=</span><span class="n">geometry_msgs</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">Twist</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">          <span class="n">msg</span><span class="p">.</span><span class="n">linear</span><span class="p">.</span><span class="n">x</span><span class="o">=</span><span class="mf">1.0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">          <span class="n">msg</span><span class="p">.</span><span class="n">angular</span><span class="p">.</span><span class="n">z</span><span class="o">=</span><span class="mf">0.5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">          <span class="n">publisher_</span><span class="o">-&gt;</span><span class="n">publish</span><span class="p">(</span><span class="n">msg</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span><span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[])</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">rclcpp</span><span class="o">::</span><span class="n">init</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span><span class="n">argv</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="k">auto</span> <span class="n">node</span> <span class="o">=</span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">TurtlrCircleNode</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&#34;turtle_circle&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="n">rclcpp</span><span class="o">::</span><span class="n">spin</span><span class="p">(</span><span class="n">node</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="n">rclcpp</span><span class="o">::</span><span class="n">shutdown</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"></code></pre></td></tr></table>
</div>
</div></li>
<li>示例代码(订阅加发布话题 控制小海龟到设定的目标点)
<ul>
<li>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl">  <span class="cp">#include</span> <span class="cpf">&#34;rclcpp/rclcpp.hpp&#34;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>  <span class="cp">#include</span> <span class="cpf">&#34;geometry_msgs/msg/twist.hpp&#34;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>  <span class="cp">#include</span> <span class="cpf">&lt;chrono&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>  <span class="cp">#include</span> <span class="cpf">&#34;turtlesim/msg/pose.hpp&#34;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl">  <span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono_literals</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">class</span> <span class="nc">TurtrlControlNode</span><span class="o">:</span><span class="k">public</span> <span class="n">rclcpp</span><span class="o">::</span><span class="n">Node</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// rclcpp::TimerBase::SharedPtr timer_; //创建计时器
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="n">rclcpp</span><span class="o">::</span><span class="n">Publisher</span><span class="o">&lt;</span><span class="n">geometry_msgs</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">Twist</span><span class="o">&gt;::</span><span class="n">SharedPtr</span> <span class="n">publisher_</span><span class="p">;</span> <span class="c1">//发布者的智能指针
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="n">rclcpp</span><span class="o">::</span><span class="n">Subscription</span><span class="o">&lt;</span><span class="n">turtlesim</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">Pose</span><span class="o">&gt;::</span><span class="n">SharedPtr</span> <span class="n">subscription_</span><span class="p">;</span><span class="c1">//訂閱者的智能指針
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="kt">double</span> <span class="n">target_x_</span><span class="p">{</span><span class="mf">1.0</span><span class="p">};</span><span class="c1">//目標位置x座標
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="kt">double</span> <span class="n">target_y_</span><span class="p">{</span><span class="mf">1.0</span><span class="p">};</span> <span class="c1">//目標位置y座標
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="kt">double</span> <span class="n">k_</span><span class="p">{</span><span class="mf">1.0</span><span class="p">};</span> <span class="c1">// 比例係數
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="kt">double</span> <span class="n">max_speed_</span><span class="p">{</span><span class="mf">3.0</span><span class="p">};</span> <span class="c1">//最大速度
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">      <span class="k">explicit</span> <span class="n">TurtrlControlNode</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">node_name</span><span class="p">)</span><span class="o">:</span><span class="n">Node</span><span class="p">(</span><span class="n">node_name</span><span class="p">)</span> <span class="c1">//加入explicit关键字是防止类进行单参数隐式转换 此处只有一个参数可以被直接使用赋值构造，但是不要允许这样发生，提高代码的可维护性
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="n">publisher_</span><span class="o">=</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">create_publisher</span><span class="o">&lt;</span><span class="n">geometry_msgs</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">Twist</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&#34;/turtle1/cmd_vel&#34;</span><span class="p">,</span><span class="mi">10</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">          <span class="c1">// timer_=this-&gt;create_wall_timer(1000ms,std::bind(&amp;TurtrlControlNode::timer_callback,this));
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>          <span class="n">subscription_</span><span class="o">=</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">create_subscription</span><span class="o">&lt;</span><span class="n">turtlesim</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">Pose</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&#34;/turtle1/pose&#34;</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">bind</span><span class="p">(</span><span class="o">&amp;</span><span class="n">TurtrlControlNode</span><span class="o">::</span><span class="n">on_pose_recevied</span><span class="p">,</span><span class="k">this</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">placeholders</span><span class="o">::</span><span class="n">_1</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="kt">void</span> <span class="nf">on_pose_recevied</span><span class="p">(</span><span class="k">const</span> <span class="n">turtlesim</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">Pose</span><span class="o">::</span><span class="n">SharedPtr</span> <span class="n">pose</span><span class="p">)</span> <span class="c1">//參數：收到數據的共享指針
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="c1">//1.獲取當前位置
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>          <span class="k">auto</span> <span class="n">current_x</span><span class="o">=</span><span class="n">pose</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">          <span class="k">auto</span> <span class="n">current_y</span><span class="o">=</span><span class="n">pose</span><span class="o">-&gt;</span><span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">          <span class="n">RCLCPP_INFO</span><span class="p">(</span><span class="n">get_logger</span><span class="p">(),</span><span class="s">&#34;當前的：x=%f,y=%f&#34;</span><span class="p">,</span><span class="n">current_x</span><span class="p">,</span><span class="n">current_y</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">          <span class="c1">//2.計算當前的位置和目標位置的距離和朝向的差
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>          <span class="k">auto</span> <span class="n">distance</span><span class="o">=</span><span class="n">std</span><span class="o">::</span><span class="n">sqrt</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">              <span class="p">(</span><span class="n">target_x_</span><span class="o">-</span><span class="n">current_x</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">target_x_</span><span class="o">-</span><span class="n">current_x</span><span class="p">)</span><span class="o">+</span>
</span></span><span class="line"><span class="cl">              <span class="p">(</span><span class="n">target_y_</span><span class="o">-</span><span class="n">current_y</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">target_y_</span><span class="o">-</span><span class="n">current_y</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="p">);</span>
</span></span><span class="line"><span class="cl">          <span class="k">auto</span> <span class="n">angle</span><span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">atan2</span><span class="p">((</span><span class="n">target_y_</span><span class="o">-</span><span class="n">current_y</span><span class="p">),(</span><span class="n">target_x_</span><span class="o">-</span><span class="n">current_x</span><span class="p">))</span> <span class="o">-</span> <span class="n">pose</span><span class="o">-&gt;</span><span class="n">theta</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">          <span class="c1">//3.利用角度差和位置差輸出控制
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>          <span class="k">auto</span> <span class="n">msg</span><span class="o">=</span><span class="n">geometry_msgs</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">Twist</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">          <span class="k">if</span><span class="p">(</span><span class="n">distance</span><span class="o">&gt;</span><span class="mf">0.2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="p">{</span>
</span></span><span class="line"><span class="cl">              <span class="k">if</span><span class="p">(</span><span class="n">fabs</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span><span class="o">&gt;</span><span class="mf">0.2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">              <span class="p">{</span>
</span></span><span class="line"><span class="cl">                  <span class="n">msg</span><span class="p">.</span><span class="n">angular</span><span class="p">.</span><span class="n">z</span><span class="o">=</span><span class="n">fabs</span><span class="p">(</span><span class="n">angle</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">              <span class="p">}</span>
</span></span><span class="line"><span class="cl">              <span class="k">else</span>
</span></span><span class="line"><span class="cl">              <span class="p">{</span>
</span></span><span class="line"><span class="cl">                  <span class="n">msg</span><span class="p">.</span><span class="n">linear</span><span class="p">.</span><span class="n">x</span><span class="o">=</span><span class="n">k_</span><span class="o">*</span><span class="n">distance</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">              <span class="p">}</span>
</span></span><span class="line"><span class="cl">          <span class="p">}</span>
</span></span><span class="line"><span class="cl">          <span class="c1">//4.限制線速度最大值
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>          <span class="k">if</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">linear</span><span class="p">.</span><span class="n">x</span><span class="o">&gt;</span><span class="n">max_speed_</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="p">{</span>
</span></span><span class="line"><span class="cl">              <span class="n">msg</span><span class="p">.</span><span class="n">linear</span><span class="p">.</span><span class="n">x</span><span class="o">=</span><span class="n">max_speed_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">          <span class="p">}</span>
</span></span><span class="line"><span class="cl">          <span class="n">publisher_</span><span class="o">-&gt;</span><span class="n">publish</span><span class="p">(</span><span class="n">msg</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span><span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[])</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">rclcpp</span><span class="o">::</span><span class="n">init</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span><span class="n">argv</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="k">auto</span> <span class="n">node</span> <span class="o">=</span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">TurtrlControlNode</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&#34;turtle_control&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="n">rclcpp</span><span class="o">::</span><span class="n">spin</span><span class="p">(</span><span class="n">node</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="n">rclcpp</span><span class="o">::</span><span class="n">shutdown</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"></code></pre></td></tr></table>
</div>
</div></li>
</ul>
</li>
<li>实战话题小项目：获取系统状态并且qt显示，通过ROS通讯实现局域网通讯
<ul>
<li><img src="/p/linux_learn/18.png"
	width="1668"
	height="1229"
	srcset="/p/linux_learn/18_hu_4d21adbd91a78612.png 480w, /p/linux_learn/18_hu_e7a6c8cc798bef59.png 1024w"
	loading="lazy"
	
		alt="框架图"
	
	
		class="gallery-image" 
		data-flex-grow="135"
		data-flex-basis="325px"
	
></li>
<li>第一步：自定义通讯接口
<ul>
<li>(1). 新建工作空间topic_practice_ws,在新的工作空间中新建src文件夹创建消息接口的功能包
<ul>
<li>ros2 pkg create status_interfaces &ndash;dependencies builtin_interfaces rosidl_default_generators &ndash;license Apache-2.0</li>
</ul>
</li>
<li>(2). 在生成的工作包中新建msg文件夹新建好自己的的消息接口文件,(命名规则要求为骆驼峰命名，即开头第一个字母为大写,后缀为.msg),SystemStatus.msg
<ul>
<li>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl">  <span class="n">builtin_interfaces</span><span class="o">/</span><span class="n">Time</span> <span class="n">stamp</span> <span class="err">#记录时间辍引入其他功能包的消息接口，注意去除</span><span class="n">msg文件路径</span>
</span></span><span class="line"><span class="cl">  <span class="n">string</span> <span class="n">host_name</span> <span class="err">#</span> <span class="err">主机名字</span>
</span></span><span class="line"><span class="cl">  <span class="n">float32</span> <span class="n">cpu_percent</span> <span class="err">#</span> <span class="n">CPU使用率</span>
</span></span><span class="line"><span class="cl">  <span class="n">float32</span> <span class="n">memory_percent</span> <span class="err">#</span> <span class="err">内存使用率</span>
</span></span><span class="line"><span class="cl">  <span class="n">float32</span> <span class="n">memory_total</span> <span class="err">#</span> <span class="err">内存总大小</span>
</span></span><span class="line"><span class="cl">  <span class="n">float32</span> <span class="n">memory_available</span> <span class="err">#</span> <span class="err">内存剩于量</span>
</span></span><span class="line"><span class="cl">  <span class="n">float32</span> <span class="n">net_sent</span> <span class="err">#</span> <span class="err">网络发送数据总量</span> <span class="mi">1</span><span class="n">MB</span><span class="o">=</span><span class="mi">1</span><span class="n">Mb</span>
</span></span><span class="line"><span class="cl">  <span class="n">float32</span> <span class="n">net_recv</span> <span class="err">#</span> <span class="err">网络数据接受总量</span> <span class="mi">1</span><span class="n">MB</span><span class="o">=</span><span class="mi">1</span><span class="n">Mb</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"></code></pre></td></tr></table>
</div>
</div></li>
<li>(3). 在cmakelist文件中添加一段：
-```cpp
# cmake 函数，来自rosidl_default_generators 用于将msg等消息将接口定义文件转换成库或者头文件类
rosidl_generators_interfaces{
${PROJECT_NAME}
&ldquo;msg/SystemStatus.msg&rdquo;
DEPENDENCIES builtin_interfaces
}
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"></code></pre></td></tr></table>
</div>
</div></li>
<li>(4). 再在package.xml文件中添加一行声明应用了其他文件功能包：
<ul>
<li>&lt;member_of_group&gt;rosidl_interface_packages&lt;/member_of_group&gt;</li>
</ul>
</li>
<li>(5). 回到src同级目录下进行colcon build构建,之后先source install/setup.bash更新一下环境变量，之后可以运行：ros2 interface show status_interfaces/msg/SystemStatus 查看一下接口信息是否正确</li>
</ul>
</li>
<li>第二步：系统信息获取和发布
<ul>
<li>(1). 先在同一个工作空间下新建一个python功能包</li>
<li>(2). 再新建一个py文件
<ul>
<li>代码示例：</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">rclpy</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">status_interfaces.msg</span> <span class="kn">import</span> <span class="n">SystemStatus</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">rclpy.node</span> <span class="kn">import</span> <span class="n">Node</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">psutil</span> <span class="c1">#获取系统信息库</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">platform</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">SysStatusPub</span><span class="p">(</span><span class="n">Node</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">node_name</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">node_name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">status_publisher_</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">create_publisher</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">SystemStatus</span><span class="p">,</span><span class="s1">&#39;sys_status&#39;</span><span class="p">,</span><span class="mi">10</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">timer_</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">create_timer</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">timer_callback</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">timer_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
</span></span><span class="line"><span class="cl">        <span class="c1"># builtin_interfaces/Time stamp #记录时间辍引入其他功能包的消息接口，注意去除msg文件路径</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># string host_name # 主机名字</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># float32 cpu_percent # CPU使用率</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># float32 memory_percent # 内存使用率</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># float32 memory_total # 内存总大小</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># float32 memory_available # 内存剩于量</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># float32 net_sent # 网络发送数据总量 1MB=1Mb</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># float32 net_recv # 网络数据接受总量 1MB=1Mb</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">cpu_percent</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">cpu_percent</span><span class="p">()</span> <span class="c1">#cpu当前使用率</span>
</span></span><span class="line"><span class="cl">        <span class="n">memory_info</span><span class="o">=</span><span class="n">psutil</span><span class="o">.</span><span class="n">virtual_memory</span><span class="p">()</span> <span class="c1"># 内存相关信息</span>
</span></span><span class="line"><span class="cl">        <span class="n">net_io_counters</span><span class="o">=</span><span class="n">psutil</span><span class="o">.</span><span class="n">net_io_counters</span><span class="p">()</span> <span class="c1"># 网络输入输出相关信息</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">msg</span><span class="o">=</span><span class="n">SystemStatus</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">msg</span><span class="o">.</span><span class="n">stamp</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_clock</span><span class="p">()</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">to_msg</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">msg</span><span class="o">.</span><span class="n">host_name</span><span class="o">=</span><span class="n">platform</span><span class="o">.</span><span class="n">node</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">msg</span><span class="o">.</span><span class="n">cpu_percent</span><span class="o">=</span><span class="n">cpu_percent</span>
</span></span><span class="line"><span class="cl">        <span class="n">msg</span><span class="o">.</span><span class="n">memory_percent</span><span class="o">=</span><span class="n">memory_info</span><span class="o">.</span><span class="n">percent</span>
</span></span><span class="line"><span class="cl">        <span class="n">msg</span><span class="o">.</span><span class="n">memory_total</span><span class="o">=</span><span class="n">memory_info</span><span class="o">.</span><span class="n">total</span><span class="o">/</span><span class="mi">1024</span><span class="o">/</span><span class="mi">1024</span>
</span></span><span class="line"><span class="cl">        <span class="n">msg</span><span class="o">.</span><span class="n">memory_available</span><span class="o">=</span><span class="n">memory_info</span><span class="o">.</span><span class="n">available</span><span class="o">/</span><span class="mi">1024</span><span class="o">/</span><span class="mi">1024</span>
</span></span><span class="line"><span class="cl">        <span class="n">msg</span><span class="o">.</span><span class="n">net_sent</span><span class="o">=</span><span class="n">net_io_counters</span><span class="o">.</span><span class="n">bytes_sent</span><span class="o">/</span><span class="mi">1024</span><span class="o">/</span><span class="mi">1024</span>
</span></span><span class="line"><span class="cl">        <span class="n">msg</span><span class="o">.</span><span class="n">net_recv</span><span class="o">=</span><span class="n">net_io_counters</span><span class="o">.</span><span class="n">bytes_recv</span><span class="o">/</span><span class="mi">1024</span><span class="o">/</span><span class="mi">1024</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;发布：</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span><span class="c1">#ros信息终端打印信息</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">status_publisher_</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="c1">#发布信息</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">rclpy</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">node</span><span class="o">=</span><span class="n">SysStatusPub</span><span class="p">(</span><span class="s1">&#39;sys_status_pub&#39;</span><span class="p">)</span> <span class="c1">#创建节点</span>
</span></span><span class="line"><span class="cl">    <span class="n">rclpy</span><span class="o">.</span><span class="n">spin</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> <span class="c1">#spin运行节点</span>
</span></span><span class="line"><span class="cl">    <span class="n">rclpy</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span><span class="c1">#运行完之后关闭</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>(3). 在setup.py文件中加入：&lsquo;sys_status_pub=status_publisher.sys_status_pub:main&rsquo;,</li>
<li>(4). 最后colcon build以及source之后运行：ros2 run status_publisher sys_status_pub，之后可以打开另外一个终端source之后运行：ros2 topic echo /sys_status ，打印当前运行的sys_status_pub节点的发布的sys_status话题，此话题发布了电脑状态的msg信息</li>
</ul>
</li>
<li>第三步：在功能包中使用QT
<ul>
<li>(1). 在工作环境的src文件夹内新建status_display功能包，默认是cpp文件类型，需要加载rclcpp和status_interface，然后新建一个hello_qt.cpp文件
<ul>
<li>代码示例：
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;QApplication&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;QLabel&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;QString&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span><span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">QApplication</span> <span class="n">app</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span><span class="n">argv</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">QLabel</span><span class="o">*</span> <span class="n">lable</span><span class="o">=</span><span class="k">new</span> <span class="n">QLabel</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">QString</span> <span class="n">message</span><span class="o">=</span><span class="n">QString</span><span class="o">::</span><span class="n">fromStdString</span><span class="p">(</span><span class="s">&#34;Hello Qt!&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">lable</span><span class="o">-&gt;</span><span class="n">setText</span><span class="p">(</span><span class="n">message</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">lable</span><span class="o">-&gt;</span><span class="n">show</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">app</span><span class="p">.</span><span class="n">exec</span><span class="p">();</span><span class="c1">//执行应用，阻塞代码
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
</li>
<li>(2). 再在cmakelist文件中添加下面4行,之后构建运行即可
<ul>
<li>find_package(Qt5 REQUIRED COMPONENTS Widgets) # 查找库</li>
<li>add_executable(hello_qt src/hello_qt.cpp) # 添加可执行文件</li>
<li>target_link_libraries(hello_qt Qt5::Widgets) # 链接库</li>
<li>install(TARGETS hello_qt DESTINATION lib/${PROJECT_NAME}) # 备份文件</li>
</ul>
</li>
<li>(3). 基于本实战系统状态显示项目，如下新建一个sys_status_display.cpp：
<ul>
<li>代码示例：
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;QApplication&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;QLabel&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;QString&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;rclcpp/rclcpp.hpp&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;status_interfaces/msg/system_status.hpp&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="k">using</span> <span class="n">SystemStatus</span> <span class="o">=</span> <span class="n">status_interfaces</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">SystemStatus</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">SysStatusDisplay</span> <span class="o">:</span> <span class="k">public</span> <span class="n">rclcpp</span><span class="o">::</span><span class="n">Node</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/* data */</span>
</span></span><span class="line"><span class="cl">    <span class="n">rclcpp</span><span class="o">::</span><span class="n">Subscription</span><span class="o">&lt;</span><span class="n">SystemStatus</span><span class="o">&gt;::</span><span class="n">SharedPtr</span> <span class="n">subscriber_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">QLabel</span> <span class="o">*</span><span class="n">lable</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">SysStatusDisplay</span><span class="p">(</span><span class="cm">/* args */</span><span class="p">)</span> <span class="o">:</span> <span class="n">Node</span><span class="p">(</span><span class="s">&#34;sys_status_display&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">lable</span> <span class="o">=</span> <span class="k">new</span> <span class="n">QLabel</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">subscriber_</span> <span class="o">=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">create_subscription</span><span class="o">&lt;</span><span class="n">SystemStatus</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&#34;sys_status&#34;</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="p">[</span><span class="o">&amp;</span><span class="p">](</span><span class="k">const</span> <span class="n">SystemStatus</span><span class="o">::</span><span class="n">SharedPtr</span> <span class="n">msg</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">void</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">lable</span><span class="o">-&gt;</span><span class="n">setText</span><span class="p">(</span><span class="n">get_qstr_from_msg</span><span class="p">(</span><span class="n">msg</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">        <span class="p">});</span>
</span></span><span class="line"><span class="cl">        <span class="n">lable</span><span class="o">-&gt;</span><span class="n">setText</span><span class="p">(</span><span class="n">get_qstr_from_msg</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">SystemStatus</span><span class="o">&gt;</span><span class="p">()));</span>
</span></span><span class="line"><span class="cl">        <span class="n">lable</span><span class="o">-&gt;</span><span class="n">show</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// msg.stamp=self.get_clock().now().to_msg()
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// msg.host_name=platform.node()
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// msg.cpu_percent=cpu_percent
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// msg.memory_percent=memory_info.percent
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// msg.memory_total=memory_info.total/1024/1024
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// msg.memory_available=memory_info.available/1024/1024
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// msg.net_sent=net_io_counters.bytes_sent/1024/1024
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// msg.net_recv=net_io_counters.bytes_recv/1024/1024
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="n">QString</span> <span class="nf">get_qstr_from_msg</span><span class="p">(</span><span class="k">const</span> <span class="n">SystemStatus</span><span class="o">::</span><span class="n">SharedPtr</span> <span class="n">msg</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">std</span><span class="o">::</span><span class="n">stringstream</span> <span class="n">show_str</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">show_str</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;&lt;</span><span class="s">&#34;========系统状态可视化显示工具==========</span><span class="se">\n</span><span class="s">&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;&lt;</span><span class="s">&#34; 数 据 时 间：</span><span class="se">\t</span><span class="s">&#34;</span><span class="o">&lt;&lt;</span><span class="n">msg</span><span class="o">-&gt;</span><span class="n">stamp</span><span class="p">.</span><span class="n">sec</span><span class="o">&lt;&lt;</span><span class="s">&#34;</span><span class="se">\t</span><span class="s">s</span><span class="se">\n</span><span class="s">&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;&lt;</span><span class="s">&#34; 主 机 名 字：</span><span class="se">\t</span><span class="s">&#34;</span><span class="o">&lt;&lt;</span><span class="n">msg</span><span class="o">-&gt;</span><span class="n">host_name</span><span class="o">&lt;&lt;</span><span class="s">&#34;</span><span class="se">\t</span><span class="s">s</span><span class="se">\n</span><span class="s">&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;&lt;</span><span class="s">&#34; CPU 使 用 率：</span><span class="se">\t</span><span class="s">&#34;</span><span class="o">&lt;&lt;</span><span class="n">msg</span><span class="o">-&gt;</span><span class="n">cpu_percent</span><span class="o">&lt;&lt;</span><span class="s">&#34;</span><span class="se">\t</span><span class="s">%</span><span class="se">\n</span><span class="s">&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;&lt;</span><span class="s">&#34; 内 存 使 用 率：</span><span class="se">\t</span><span class="s">&#34;</span><span class="o">&lt;&lt;</span><span class="n">msg</span><span class="o">-&gt;</span><span class="n">memory_percent</span><span class="o">&lt;&lt;</span><span class="s">&#34;</span><span class="se">\t</span><span class="s">%</span><span class="se">\n</span><span class="s">&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;&lt;</span><span class="s">&#34; 内 存 总 量：</span><span class="se">\t</span><span class="s">&#34;</span><span class="o">&lt;&lt;</span><span class="n">msg</span><span class="o">-&gt;</span><span class="n">memory_total</span><span class="o">&lt;&lt;</span><span class="s">&#34;</span><span class="se">\t</span><span class="s">MB</span><span class="se">\n</span><span class="s">&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;&lt;</span><span class="s">&#34; 内 存 剩 余：</span><span class="se">\t</span><span class="s">&#34;</span><span class="o">&lt;&lt;</span><span class="n">msg</span><span class="o">-&gt;</span><span class="n">memory_available</span><span class="o">&lt;&lt;</span><span class="s">&#34;</span><span class="se">\t</span><span class="s">MB</span><span class="se">\n</span><span class="s">&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;&lt;</span><span class="s">&#34; 网 络 发 送：</span><span class="se">\t</span><span class="s">&#34;</span><span class="o">&lt;&lt;</span><span class="n">msg</span><span class="o">-&gt;</span><span class="n">net_sent</span><span class="o">&lt;&lt;</span><span class="s">&#34;</span><span class="se">\t</span><span class="s">MB</span><span class="se">\n</span><span class="s">&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;&lt;</span><span class="s">&#34; 网 络 接 受：</span><span class="se">\t</span><span class="s">&#34;</span><span class="o">&lt;&lt;</span><span class="n">msg</span><span class="o">-&gt;</span><span class="n">net_recv</span><span class="o">&lt;&lt;</span><span class="s">&#34;</span><span class="se">\t</span><span class="s">MB</span><span class="se">\n</span><span class="s">&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;&lt;</span><span class="s">&#34;=====================================&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">QString</span><span class="o">::</span><span class="n">fromStdString</span><span class="p">(</span><span class="n">show_str</span><span class="p">.</span><span class="n">str</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">rclcpp</span><span class="o">::</span><span class="n">init</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span><span class="n">argv</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">QApplication</span> <span class="n">app</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">auto</span> <span class="n">node</span><span class="o">=</span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">SysStatusDisplay</span><span class="o">&gt;</span><span class="p">();</span> 
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="kr">thread</span> <span class="n">spin_thread</span><span class="p">([</span><span class="o">&amp;</span><span class="p">]()</span><span class="o">-&gt;</span><span class="kt">void</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">rclcpp</span><span class="o">::</span><span class="n">spin</span><span class="p">(</span><span class="n">node</span><span class="p">);</span> <span class="c1">//启动node节点,阻塞代码
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="n">spin_thread</span><span class="p">.</span><span class="n">detach</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">app</span><span class="p">.</span><span class="n">exec</span><span class="p">();</span> <span class="c1">// 执行应用，阻塞代码
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>(4). 更改好cmakelist文件内容，链接好库：</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl">    <span class="n">add_executable</span><span class="p">(</span><span class="n">sys_status_display</span> <span class="n">src</span><span class="o">/</span><span class="n">sys_status_display</span><span class="p">.</span><span class="n">cpp</span><span class="p">)</span> <span class="err">#</span> <span class="err">添加可执行文件</span>
</span></span><span class="line"><span class="cl">    <span class="n">target_link_libraries</span><span class="p">(</span><span class="n">sys_status_display</span> <span class="n">Qt5</span><span class="o">::</span><span class="n">Widgets</span><span class="p">)</span> <span class="err">#</span> <span class="err">链接库</span>
</span></span><span class="line"><span class="cl">    <span class="n">ament_target_dependencies</span><span class="p">(</span><span class="n">sys_status_display</span> <span class="n">rclcpp</span> <span class="n">status_interfaces</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">install</span><span class="p">(</span><span class="n">TARGETS</span> <span class="n">hello_qt</span> <span class="n">sys_status_display</span>
</span></span><span class="line"><span class="cl">    <span class="n">DESTINATION</span> <span class="n">lib</span><span class="o">/</span><span class="err">$</span><span class="p">{</span><span class="n">PROJECT_NAME</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span> <span class="err">#</span> <span class="err">备份文件</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>(5). 最后分别运行status_publisher sys_status_pub和status_display sys_status_display 正常看到显示即<strong>大功告成！</strong></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img src="/p/linux_learn/19.png"
	width="2041"
	height="1195"
	srcset="/p/linux_learn/19_hu_20aa5ffcc4f14cbb.png 480w, /p/linux_learn/19_hu_d4684e08e3eaa8a0.png 1024w"
	loading="lazy"
	
		alt="最后运行效果图"
	
	
		class="gallery-image" 
		data-flex-grow="170"
		data-flex-basis="409px"
	
></p>
<h3 id="313-服务">3.13 服务
</h3><ul>
<li>
<p>初步认识使用服务：</p>
<ul>
<li>示例：
<ul>
<li>打开小海龟显示节点(记不起来就双tap)
<ul>
<li>ros2 run turtlesim turtlesim_node</li>
</ul>
</li>
<li>之后再打开另外一个终端(ctrl+alt+t)运行下面图片查看服务，查看某个服务消息详情，call启动一个服务消息
<ul>
<li>ros2 service list -t</li>
<li>ros2 interface show turtlesim/srv/Spawn</li>
<li>ros2 service call spawn turtlesim/srv/Spawn &ldquo;{x: 1, y: 1}&rdquo;</li>
</ul>
</li>
<li>使用图形化交互界面：rqt
<ul>
<li><img src="/p/linux_learn/20.png"
	width="2036"
	height="1244"
	srcset="/p/linux_learn/20_hu_fb5d81d0dd8619b9.png 480w, /p/linux_learn/20_hu_7781642a710ff9e9.png 1024w"
	loading="lazy"
	
		alt="服务初识"
	
	
		class="gallery-image" 
		data-flex-grow="163"
		data-flex-basis="392px"
	
></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>基于服务的参数通信</p>
<ul>
<li>服务的一些参数列表展示:ros2 param list
<ul>
<li>之后可以打印详细的参数介绍信息：ros2 param describe /turtlesim background_r</li>
<li>还可以打印获取当前参数的值：ros2 param get /turtlesim background_r</li>
<li>还可以设置当前参数的值：ros2 param set /turtlesim background_r 255</li>
</ul>
</li>
<li>一般配置多个参数时最快便捷方法是导出yaml参数文件，之后编辑文件中的参数既可，随后运行相应节点时将yaml参数配置文件一起启用配置
<ul>
<li>导出服务参数为yaml文件：
<ul>
<li>ros2 param dump /turtlesim &gt; turtlesim_param.yaml</li>
</ul>
</li>
<li>查看当前导出的yaml文件
<ul>
<li>cat turtlesim_param.yaml</li>
</ul>
</li>
<li>启动节点时使用yaml的配置文件：
<ul>
<li>ros2 run turtlesim turtlesim_node &ndash;ros-args &ndash;params-file turtlesim_param.yaml 【其实就是rclcpp.init(argc,argv)时将yaml传入作为初始化参数】</li>
</ul>
</li>
<li>或者是rqt中的动态配置configuration直接调整修改值</li>
</ul>
</li>
</ul>
</li>
<li>
<p>自定义服务接口(人脸识别示例)</p>
<ul>
<li>
<p>新建号chapt4文件下src内新建一个chapt4_interfaces功能包：</p>
<ul>
<li>ros2 pkg create chapt4_interfaces &ndash;dependencies sensor_msgs rosidl_default_generators &ndash;license Apache-2.0</li>
</ul>
</li>
<li>
<p>再在功能包内新建srv服务接口文件夹，在此文件夹内新建FaceDetector.srv文件并且更改cmakelist和package.xml文件内容：</p>
<ul>
<li>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl">  <span class="n">sensor_msgs</span><span class="o">/</span><span class="n">Image</span> <span class="n">image</span>     <span class="err">#人脸图像</span>
</span></span><span class="line"><span class="cl">  <span class="o">---</span>
</span></span><span class="line"><span class="cl">  <span class="n">int16</span> <span class="n">number</span>    <span class="err">#识别到的人脸个数</span>
</span></span><span class="line"><span class="cl">  <span class="n">float32</span> <span class="n">use_time</span>  <span class="err">#识别耗时</span>
</span></span><span class="line"><span class="cl">  <span class="n">int32</span><span class="p">[]</span> <span class="n">top</span>   <span class="err">#人脸在图像中的位置</span>
</span></span><span class="line"><span class="cl">  <span class="n">int32</span><span class="p">[]</span> <span class="n">right</span>
</span></span><span class="line"><span class="cl">  <span class="n">int32</span><span class="p">[]</span> <span class="n">bottom</span>
</span></span><span class="line"><span class="cl">  <span class="n">int32</span><span class="p">[]</span> <span class="n">left</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">rosidl_generate_interfaces</span><span class="p">(</span><span class="err">$</span><span class="p">{</span><span class="n">PROJECT_NAME</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;srv/FaceDetector.srv&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="n">DEPENDENCIES</span> <span class="n">sensor_msgs</span>
</span></span><span class="line"><span class="cl">  <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="o">&lt;</span><span class="n">member_of_group</span><span class="o">&gt;</span><span class="n">rosidl_interface_packages</span><span class="o">&lt;/</span><span class="n">member_of_group</span><span class="o">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>之后切换到src的同级目录下进行colcon build再source install/setup.bash ，最后运行ros2 interface show chapt4_interfaces/srv/FaceDetector 查看是否有对应的服务接口信息既可</p>
</li>
</ul>
</li>
<li>
<p>人脸检测python服务通信：(python在mvenv环境下)</p>
<ul>
<li>新建一个start_mvenv.sh文件一键配置虚拟环境
<ul>
<li>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">  <span class="c1">#!/bin/bash</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># 激活虚拟环境</span>
</span></span><span class="line"><span class="cl">  <span class="nb">source</span> ~/mvenv/bin/activate
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># 配置 ROS2 环境 需要根据自己的系统来配置</span>
</span></span><span class="line"><span class="cl">  <span class="nb">source</span> /opt/ros/jazzy/setup.bash
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># 配置你的工作空间</span>
</span></span><span class="line"><span class="cl">  <span class="nb">source</span> ~/chapt4/chapt4_ws/install/setup.bash
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># 把虚拟环境的 Python 路径加入到 ROS2 的 Python 路径中 后续其他工程或者工作空间的python中需要ros2调用自己创建的虚拟环境的第三方库时直接修该这段中的对应虚拟环境的名词/位置即可</span>
</span></span><span class="line"><span class="cl">  <span class="nb">export</span> <span class="nv">PYTHONPATH</span><span class="o">=</span><span class="nv">$PYTHONPATH</span>:/home/robot/mvenv/lib/python3.12/site-packages
</span></span><span class="line"><span class="cl">  <span class="nb">echo</span> <span class="s2">&#34;ROS2 + Python 虚拟环境已配置完成！&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
</li>
<li>新建功能包ros2 pkg create demo_python_service &ndash;build-type ament_python &ndash;dependencies rclpy chapt4_interfaces &ndash;license Apache-2.0</li>
<li>需要找到一张需要检测的照片放到resource文件夹内，随后更改setup.py文件，表示在colcon build拷贝一份时将source文件下的这张照片也一起拷贝
<ul>
<li>(&lsquo;share/&rsquo; + package_name+&quot;/resource&quot;, [&lsquo;resource/defult.jpg&rsquo;]),</li>
</ul>
</li>
<li>然后新建learn_face_detect.py，代码示例：
<ul>
<li>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">  <span class="kn">import</span> <span class="nn">face_recognition</span>
</span></span><span class="line"><span class="cl">  <span class="kn">import</span> <span class="nn">cv2</span>
</span></span><span class="line"><span class="cl">  <span class="kn">from</span> <span class="nn">ament_index_python.packages</span> <span class="kn">import</span> <span class="n">get_package_share_directory</span> <span class="c1">#导入功能包share目录绝对路径</span>
</span></span><span class="line"><span class="cl">  <span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">      <span class="c1">#获取图片的真实路径 /home/robot/chapt4/chapt4_ws/install/demo_python_service/share/demo_python_service</span>
</span></span><span class="line"><span class="cl">      <span class="n">default_image_path</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">get_package_share_directory</span><span class="p">(</span><span class="s1">&#39;demo_python_service&#39;</span><span class="p">),</span><span class="s1">&#39;/resource/defult.jpg&#39;</span><span class="p">)</span><span class="c1">#os库自动判断连接路径是否需要/链接</span>
</span></span><span class="line"><span class="cl">      <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;图片的真实路径：</span><span class="si">{</span><span class="n">default_image_path</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="c1">#使用cv2加载图片</span>
</span></span><span class="line"><span class="cl">      <span class="n">image</span><span class="o">=</span><span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">default_image_path</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="c1">#检测人脸</span>
</span></span><span class="line"><span class="cl">      <span class="n">face_locations</span><span class="o">=</span><span class="n">face_recognition</span><span class="o">.</span><span class="n">face_locations</span><span class="p">(</span><span class="n">image</span><span class="p">,</span><span class="n">number_of_times_to_upsample</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">model</span><span class="o">=</span><span class="s1">&#39;hog&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="c1">#绘制人脸框</span>
</span></span><span class="line"><span class="cl">      <span class="k">for</span> <span class="n">top</span><span class="p">,</span><span class="n">right</span><span class="p">,</span><span class="n">bottom</span><span class="p">,</span><span class="n">left</span> <span class="ow">in</span> <span class="n">face_locations</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">          <span class="n">cv2</span><span class="o">.</span><span class="n">rectangle</span><span class="p">(</span><span class="n">image</span><span class="p">,(</span><span class="n">left</span><span class="p">,</span><span class="n">top</span><span class="p">),(</span><span class="n">right</span><span class="p">,</span><span class="n">bottom</span><span class="p">),(</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="mi">4</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="c1">#结果显示</span>
</span></span><span class="line"><span class="cl">      <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;Face Detecte result&#39;</span><span class="p">,</span><span class="n">image</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"></code></pre></td></tr></table>
</div>
</div></li>
<li>然后分别运行,之后再运行ros2 run demo_python_service learn_face_detect
<ul>
<li>source start_mvenv.sh</li>
<li>colcon build source</li>
<li>install/setup.bash</li>
</ul>
</li>
<li>下面为正式开始人脸检测服务部分：
<ul>
<li>新建face_detect_node.py代码示例：
<ul>
<li>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">  <span class="kn">import</span> <span class="nn">rclpy</span>
</span></span><span class="line"><span class="cl">  <span class="kn">from</span> <span class="nn">rclpy.node</span> <span class="kn">import</span> <span class="n">Node</span>
</span></span><span class="line"><span class="cl">  <span class="kn">from</span> <span class="nn">chapt4_interfaces.srv</span> <span class="kn">import</span> <span class="n">FaceDetector</span>
</span></span><span class="line"><span class="cl">  <span class="kn">import</span> <span class="nn">face_recognition</span>
</span></span><span class="line"><span class="cl">  <span class="kn">import</span> <span class="nn">cv2</span>
</span></span><span class="line"><span class="cl">  <span class="kn">from</span> <span class="nn">ament_index_python.packages</span> <span class="kn">import</span> <span class="n">get_package_share_directory</span> <span class="c1">#导入功能包share目录绝对路径</span>
</span></span><span class="line"><span class="cl">  <span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="cl">  <span class="kn">from</span> <span class="nn">cv_bridge</span> <span class="kn">import</span> <span class="n">CvBridge</span>
</span></span><span class="line"><span class="cl">  <span class="kn">import</span> <span class="nn">time</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">class</span> <span class="nc">FaceDetectNode</span><span class="p">(</span><span class="n">Node</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">      <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">          <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="s1">&#39;face_detect_node&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="bp">self</span><span class="o">.</span><span class="n">service_</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">create_service</span><span class="p">(</span><span class="n">FaceDetector</span><span class="p">,</span><span class="s1">&#39;face_detect&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">detect_face_callback</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="bp">self</span><span class="o">.</span><span class="n">bridge</span><span class="o">=</span><span class="n">CvBridge</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">          <span class="bp">self</span><span class="o">.</span><span class="n">number_of_times_to_upsample</span><span class="o">=</span><span class="mi">1</span>
</span></span><span class="line"><span class="cl">          <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">=</span><span class="s1">&#39;hog&#39;</span>
</span></span><span class="line"><span class="cl">          <span class="bp">self</span><span class="o">.</span><span class="n">default_image_path</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">get_package_share_directory</span><span class="p">(</span><span class="s1">&#39;demo_python_service&#39;</span><span class="p">),</span><span class="s1">&#39;resource/defult.jpg&#39;</span><span class="p">)</span><span class="c1">#os库自动判断连接路径是否需要/链接</span>
</span></span><span class="line"><span class="cl">          <span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;人脸检测服务成功开启！&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="k">def</span> <span class="nf">detect_face_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">request</span><span class="p">,</span><span class="n">response</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">          <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">              <span class="n">cv_image</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bridge</span><span class="o">.</span><span class="n">imgmsg_to_cv2</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">image</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">              <span class="n">cv_image</span><span class="o">=</span><span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">default_image_path</span><span class="p">)</span><span class="c1">#若请求的图片内容为空则识别默认的照片内容，目录位置为上面</span>
</span></span><span class="line"><span class="cl">              <span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;传入图像为空，使用默认图像！&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="c1">#此处的cv_image图像已经是一个opencv格式的图像</span>
</span></span><span class="line"><span class="cl">          <span class="n">start_time</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">          <span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;加载完成图像，开始人脸识别！&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="n">face_locations</span><span class="o">=</span><span class="n">face_recognition</span><span class="o">.</span><span class="n">face_locations</span><span class="p">(</span><span class="n">cv_image</span><span class="p">,</span><span class="n">number_of_times_to_upsample</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">number_of_times_to_upsample</span><span class="p">,</span><span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">          <span class="n">response</span><span class="o">.</span><span class="n">use_time</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">start_time</span>
</span></span><span class="line"><span class="cl">          <span class="n">response</span><span class="o">.</span><span class="n">number</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">face_locations</span><span class="p">)</span> <span class="c1">#face_locations是一个列表里面其实就是识别出来有多少组人链数组</span>
</span></span><span class="line"><span class="cl">          <span class="k">for</span> <span class="n">top</span><span class="p">,</span><span class="n">right</span><span class="p">,</span><span class="n">bottom</span><span class="p">,</span><span class="n">left</span> <span class="ow">in</span> <span class="n">face_locations</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">              <span class="n">response</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">top</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">              <span class="n">response</span><span class="o">.</span><span class="n">right</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">right</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">              <span class="n">response</span><span class="o">.</span><span class="n">bottom</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bottom</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">              <span class="n">response</span><span class="o">.</span><span class="n">left</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">left</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="k">return</span> <span class="n">response</span> <span class="c1">#必须返回response</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">      <span class="n">rclpy</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">      <span class="n">node</span><span class="o">=</span><span class="n">FaceDetectNode</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">      <span class="n">rclpy</span><span class="o">.</span><span class="n">spin</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="n">rclpy</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"></code></pre></td></tr></table>
</div>
</div></li>
<li>之后修改好setup.py然后直接运行即可，打开另外一个终端列出服务：ros2 service list -t，之后再运行service call这个发布的服务消息接口即可，识别出默认的图片内容</li>
</ul>
</li>
<li>人脸检测的客户端实现
<ul>
<li>现在resource目录下添加好需要识别的照片，然后修改好setup.py在colcon build时将照片也一起拷贝过去</li>
<li>然后正常地新建好face_detect_client_node.py代码示例如下：
<ul>
<li>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">  <span class="kn">import</span> <span class="nn">rclpy</span>
</span></span><span class="line"><span class="cl">  <span class="kn">from</span> <span class="nn">rclpy.node</span> <span class="kn">import</span> <span class="n">Node</span>
</span></span><span class="line"><span class="cl">  <span class="kn">from</span> <span class="nn">chapt4_interfaces.srv</span> <span class="kn">import</span> <span class="n">FaceDetector</span>
</span></span><span class="line"><span class="cl">  <span class="kn">import</span> <span class="nn">face_recognition</span>
</span></span><span class="line"><span class="cl">  <span class="kn">import</span> <span class="nn">cv2</span>
</span></span><span class="line"><span class="cl">  <span class="kn">from</span> <span class="nn">ament_index_python.packages</span> <span class="kn">import</span> <span class="n">get_package_share_directory</span> <span class="c1">#导入功能包share目录绝对路径</span>
</span></span><span class="line"><span class="cl">  <span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="cl">  <span class="kn">from</span> <span class="nn">cv_bridge</span> <span class="kn">import</span> <span class="n">CvBridge</span>
</span></span><span class="line"><span class="cl">  <span class="kn">import</span> <span class="nn">time</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">class</span> <span class="nc">FaceDetectClientNode</span><span class="p">(</span><span class="n">Node</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">      <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">          <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="s1">&#39;face_detect_client_node&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="bp">self</span><span class="o">.</span><span class="n">bridge</span><span class="o">=</span><span class="n">CvBridge</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">          <span class="bp">self</span><span class="o">.</span><span class="n">default_image_path</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">get_package_share_directory</span><span class="p">(</span><span class="s1">&#39;demo_python_service&#39;</span><span class="p">),</span><span class="s1">&#39;resource/peoples.jpg&#39;</span><span class="p">)</span><span class="c1">#os库自动判断连接路径是否需要/链接</span>
</span></span><span class="line"><span class="cl">          <span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;人脸检测客户端成功开启！&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">create_client</span><span class="p">(</span><span class="n">FaceDetector</span><span class="p">,</span><span class="s1">&#39;face_detect&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">=</span><span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">default_image_path</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="k">def</span> <span class="nf">send_request</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">          <span class="c1"># 1.判断服务端是否上线</span>
</span></span><span class="line"><span class="cl">          <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">wait_for_service</span><span class="p">(</span><span class="n">timeout_sec</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">              <span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;正在等待服务端上线.....&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="c1"># 2.构造Request</span>
</span></span><span class="line"><span class="cl">          <span class="n">request</span><span class="o">=</span><span class="n">FaceDetector</span><span class="o">.</span><span class="n">Request</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">          <span class="n">request</span><span class="o">.</span><span class="n">image</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bridge</span><span class="o">.</span><span class="n">cv2_to_imgmsg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="c1"># 3.发送请求并等待处理完成</span>
</span></span><span class="line"><span class="cl">          <span class="n">future</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">call_async</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="c1"># while not future.done():</span>
</span></span><span class="line"><span class="cl">          <span class="c1">#     time.sleep(1.0) #休眠当前线程，等待服务处理完成==造成当前线程无法再接受来自服务端的返回，导致永远无法完成future.done()无法返回True</span>
</span></span><span class="line"><span class="cl">          <span class="c1"># rclpy.spin_until_future_complete(self,future) #等待服务端返回响应</span>
</span></span><span class="line"><span class="cl">          <span class="k">def</span> <span class="nf">result_callback</span><span class="p">(</span><span class="n">result_future</span><span class="p">):</span>           
</span></span><span class="line"><span class="cl">              <span class="n">response</span> <span class="o">=</span><span class="n">result_future</span><span class="o">.</span><span class="n">result</span><span class="p">()</span> <span class="c1">#获取响应结果</span>
</span></span><span class="line"><span class="cl">              <span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;接收到响应，共耗时</span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">use_time</span><span class="si">}</span><span class="s2">s,总共检测到</span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">number</span><span class="si">}</span><span class="s2">个人脸&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">              <span class="bp">self</span><span class="o">.</span><span class="n">show_response</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">          <span class="n">future</span><span class="o">.</span><span class="n">add_done_callback</span><span class="p">(</span><span class="n">result_callback</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="k">def</span> <span class="nf">show_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">resonse</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">          <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">resonse</span><span class="o">.</span><span class="n">number</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">              <span class="n">top</span><span class="o">=</span><span class="n">resonse</span><span class="o">.</span><span class="n">top</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">              <span class="n">left</span><span class="o">=</span><span class="n">resonse</span><span class="o">.</span><span class="n">left</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">              <span class="n">right</span><span class="o">=</span><span class="n">resonse</span><span class="o">.</span><span class="n">right</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">              <span class="n">bottom</span><span class="o">=</span><span class="n">resonse</span><span class="o">.</span><span class="n">bottom</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">              <span class="n">cv2</span><span class="o">.</span><span class="n">rectangle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">,(</span><span class="n">left</span><span class="p">,</span><span class="n">top</span><span class="p">),(</span><span class="n">right</span><span class="p">,</span><span class="n">bottom</span><span class="p">),(</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="mi">4</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="c1">#结果显示</span>
</span></span><span class="line"><span class="cl">          <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;Face Detecte result&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="c1">#阻塞</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">      <span class="n">rclpy</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">      <span class="n">node</span><span class="o">=</span><span class="n">FaceDetectClientNode</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">      <span class="n">node</span><span class="o">.</span><span class="n">send_request</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">      <span class="n">rclpy</span><span class="o">.</span><span class="n">spin</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="n">rclpy</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>        
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"></code></pre></td></tr></table>
</div>
</div></li>
<li>之后正常运行先开始之前的服务端节点，然后再开启客户端节点进行识别既可看到现象</li>
</ul>
</li>
</ul>
</li>
<li>
<p>C++小乌龟巡航服务：</p>
<ul>
<li>新建服务通讯接口：在srv文件下新建Patrol.srv，内容示例：
<ul>
<li>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl">  <span class="n">float32</span> <span class="n">target_x</span>
</span></span><span class="line"><span class="cl">  <span class="n">float32</span> <span class="n">target_y</span>
</span></span><span class="line"><span class="cl">  <span class="o">---</span>
</span></span><span class="line"><span class="cl">  <span class="n">int8</span> <span class="n">SUCESS</span><span class="o">=</span><span class="mi">1</span>
</span></span><span class="line"><span class="cl">  <span class="n">int8</span> <span class="n">FAIL</span><span class="o">=</span><span class="mi">0</span>
</span></span><span class="line"><span class="cl">  <span class="n">int8</span> <span class="n">result</span> <span class="err">#</span> <span class="err">结果</span> <span class="err">返回</span> <span class="n">SUCESS</span> <span class="o">/</span> <span class="n">FAIL</span> <span class="err">取其中之一</span> 
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>随后更改cmakelist文件将该srv文件路径更新到里面，参考上面python的srv更新。之后直接colcon build已经source既可，查看ros2 interface show chapt4_interface/srv/Patrol 既可看到接口详细信息</li>
</ul>
</li>
<li>(服务端)在src下新建功能包：
<ul>
<li>ros2 pkg create demo_cpp_service &ndash;build-type ament_cmake &ndash;dependencies chapt4_interfaces rclcpp geometry_msgs turtlesim &ndash;license Apache-2.0</li>
<li>随后在项目名称下新建服务端turtle_control.cpp代码示例如下：
<ul>
<li>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl">  <span class="cp">#include</span> <span class="cpf">&#34;rclcpp/rclcpp.hpp&#34;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>  <span class="cp">#include</span> <span class="cpf">&#34;geometry_msgs/msg/twist.hpp&#34;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>  <span class="cp">#include</span> <span class="cpf">&lt;chrono&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>  <span class="cp">#include</span> <span class="cpf">&#34;turtlesim/msg/pose.hpp&#34;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>  <span class="cp">#include</span> <span class="cpf">&#34;chapt4_interfaces/srv/patrol.hpp&#34;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>  <span class="k">using</span> <span class="n">Patrol</span><span class="o">=</span><span class="n">chapt4_interfaces</span><span class="o">::</span><span class="n">srv</span><span class="o">::</span><span class="n">Patrol</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono_literals</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">class</span> <span class="nc">TurtrlControlNode</span><span class="o">:</span><span class="k">public</span> <span class="n">rclcpp</span><span class="o">::</span><span class="n">Node</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">private</span><span class="o">:</span>    
</span></span><span class="line"><span class="cl">      <span class="n">rclcpp</span><span class="o">::</span><span class="n">Service</span><span class="o">&lt;</span><span class="n">Patrol</span><span class="o">&gt;::</span><span class="n">SharedPtr</span> <span class="n">patrol_service_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="n">rclcpp</span><span class="o">::</span><span class="n">Publisher</span><span class="o">&lt;</span><span class="n">geometry_msgs</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">Twist</span><span class="o">&gt;::</span><span class="n">SharedPtr</span> <span class="n">publisher_</span><span class="p">;</span> <span class="c1">//发布者的智能指针
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="n">rclcpp</span><span class="o">::</span><span class="n">Subscription</span><span class="o">&lt;</span><span class="n">turtlesim</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">Pose</span><span class="o">&gt;::</span><span class="n">SharedPtr</span> <span class="n">subscription_</span><span class="p">;</span><span class="c1">//訂閱者的智能指針
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="kt">double</span> <span class="n">target_x_</span><span class="p">{</span><span class="mf">1.0</span><span class="p">};</span><span class="c1">//目標位置x座標
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="kt">double</span> <span class="n">target_y_</span><span class="p">{</span><span class="mf">1.0</span><span class="p">};</span> <span class="c1">//目標位置y座標
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="kt">double</span> <span class="n">k_</span><span class="p">{</span><span class="mf">1.0</span><span class="p">};</span> <span class="c1">// 比例係數
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="kt">double</span> <span class="n">max_speed_</span><span class="p">{</span><span class="mf">3.0</span><span class="p">};</span> <span class="c1">//最大速度
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">      <span class="k">explicit</span> <span class="n">TurtrlControlNode</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">node_name</span><span class="p">)</span><span class="o">:</span><span class="n">Node</span><span class="p">(</span><span class="n">node_name</span><span class="p">)</span> <span class="c1">//加入explicit关键字是防止类进行单参数隐式转换 此处只有一个参数可以被直接使用赋值构造，但是不要允许这样发生，提高代码的可维护性
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="n">patrol_service_</span><span class="o">=</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">create_service</span><span class="o">&lt;</span><span class="n">Patrol</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&#34;patrol&#34;</span><span class="p">,[</span><span class="o">&amp;</span><span class="p">](</span><span class="k">const</span> <span class="n">Patrol</span><span class="o">::</span><span class="n">Request</span><span class="o">::</span><span class="n">SharedPtr</span> <span class="n">request</span><span class="p">,</span><span class="n">Patrol</span><span class="o">::</span><span class="n">Response</span><span class="o">::</span><span class="n">SharedPtr</span> <span class="n">response</span><span class="p">)</span><span class="o">-&gt;</span><span class="kt">void</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">              <span class="k">if</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                  <span class="p">(</span><span class="mi">0</span><span class="o">&lt;</span><span class="n">request</span><span class="o">-&gt;</span><span class="n">target_x</span><span class="o">&amp;&amp;</span><span class="n">request</span><span class="o">-&gt;</span><span class="n">target_x</span><span class="o">&lt;</span><span class="mf">12.0f</span><span class="p">)</span><span class="o">&amp;&amp;</span>
</span></span><span class="line"><span class="cl">                  <span class="p">(</span><span class="mi">0</span><span class="o">&lt;</span><span class="n">request</span><span class="o">-&gt;</span><span class="n">target_y</span><span class="o">&amp;&amp;</span><span class="n">request</span><span class="o">-&gt;</span><span class="n">target_y</span><span class="o">&lt;</span><span class="mf">12.0f</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">              <span class="p">)</span>
</span></span><span class="line"><span class="cl">              <span class="p">{</span>
</span></span><span class="line"><span class="cl">                  <span class="k">this</span><span class="o">-&gt;</span><span class="n">target_x_</span><span class="o">=</span><span class="n">request</span><span class="o">-&gt;</span><span class="n">target_x</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                  <span class="k">this</span><span class="o">-&gt;</span><span class="n">target_y_</span><span class="o">=</span><span class="n">request</span><span class="o">-&gt;</span><span class="n">target_y</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                  <span class="n">response</span><span class="o">-&gt;</span><span class="n">result</span><span class="o">=</span><span class="n">Patrol</span><span class="o">::</span><span class="n">Response</span><span class="o">::</span><span class="n">SUCESS</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">              <span class="p">}</span>
</span></span><span class="line"><span class="cl">              <span class="k">else</span>
</span></span><span class="line"><span class="cl">              <span class="p">{</span>
</span></span><span class="line"><span class="cl">                  <span class="n">response</span><span class="o">-&gt;</span><span class="n">result</span><span class="o">=</span><span class="n">Patrol</span><span class="o">::</span><span class="n">Response</span><span class="o">::</span><span class="n">FAIL</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">              <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">          <span class="p">});</span>
</span></span><span class="line"><span class="cl">          <span class="n">publisher_</span><span class="o">=</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">create_publisher</span><span class="o">&lt;</span><span class="n">geometry_msgs</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">Twist</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&#34;/turtle1/cmd_vel&#34;</span><span class="p">,</span><span class="mi">10</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">          <span class="c1">// timer_=this-&gt;create_wall_timer(1000ms,std::bind(&amp;TurtrlControlNode::timer_callback,this));
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>          <span class="n">subscription_</span><span class="o">=</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">create_subscription</span><span class="o">&lt;</span><span class="n">turtlesim</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">Pose</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&#34;/turtle1/pose&#34;</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">bind</span><span class="p">(</span><span class="o">&amp;</span><span class="n">TurtrlControlNode</span><span class="o">::</span><span class="n">on_pose_recevied</span><span class="p">,</span><span class="k">this</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">placeholders</span><span class="o">::</span><span class="n">_1</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="kt">void</span> <span class="nf">on_pose_recevied</span><span class="p">(</span><span class="k">const</span> <span class="n">turtlesim</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">Pose</span><span class="o">::</span><span class="n">SharedPtr</span> <span class="n">pose</span><span class="p">)</span> <span class="c1">//參數：收到數據的共享指針
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="c1">//1.獲取當前位置
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>          <span class="k">auto</span> <span class="n">current_x</span><span class="o">=</span><span class="n">pose</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">          <span class="k">auto</span> <span class="n">current_y</span><span class="o">=</span><span class="n">pose</span><span class="o">-&gt;</span><span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">          <span class="n">RCLCPP_INFO</span><span class="p">(</span><span class="n">get_logger</span><span class="p">(),</span><span class="s">&#34;當前的：x=%f,y=%f&#34;</span><span class="p">,</span><span class="n">current_x</span><span class="p">,</span><span class="n">current_y</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">          <span class="c1">//2.計算當前的位置和目標位置的距離和朝向的差
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>          <span class="k">auto</span> <span class="n">distance</span><span class="o">=</span><span class="n">std</span><span class="o">::</span><span class="n">sqrt</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">              <span class="p">(</span><span class="n">target_x_</span><span class="o">-</span><span class="n">current_x</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">target_x_</span><span class="o">-</span><span class="n">current_x</span><span class="p">)</span><span class="o">+</span>
</span></span><span class="line"><span class="cl">              <span class="p">(</span><span class="n">target_y_</span><span class="o">-</span><span class="n">current_y</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">target_y_</span><span class="o">-</span><span class="n">current_y</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="p">);</span>
</span></span><span class="line"><span class="cl">          <span class="k">auto</span> <span class="n">angle</span><span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">atan2</span><span class="p">((</span><span class="n">target_y_</span><span class="o">-</span><span class="n">current_y</span><span class="p">),(</span><span class="n">target_x_</span><span class="o">-</span><span class="n">current_x</span><span class="p">))</span> <span class="o">-</span> <span class="n">pose</span><span class="o">-&gt;</span><span class="n">theta</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">          <span class="c1">//3.利用角度差和位置差輸出控制
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>          <span class="k">auto</span> <span class="n">msg</span><span class="o">=</span><span class="n">geometry_msgs</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">Twist</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">          <span class="k">if</span><span class="p">(</span><span class="n">distance</span><span class="o">&gt;</span><span class="mf">0.2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="p">{</span>
</span></span><span class="line"><span class="cl">              <span class="k">if</span><span class="p">(</span><span class="n">fabs</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span><span class="o">&gt;</span><span class="mf">0.2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">              <span class="p">{</span>
</span></span><span class="line"><span class="cl">                  <span class="n">msg</span><span class="p">.</span><span class="n">angular</span><span class="p">.</span><span class="n">z</span><span class="o">=</span><span class="n">fabs</span><span class="p">(</span><span class="n">angle</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">              <span class="p">}</span>
</span></span><span class="line"><span class="cl">              <span class="k">else</span>
</span></span><span class="line"><span class="cl">              <span class="p">{</span>
</span></span><span class="line"><span class="cl">                  <span class="n">msg</span><span class="p">.</span><span class="n">linear</span><span class="p">.</span><span class="n">x</span><span class="o">=</span><span class="n">k_</span><span class="o">*</span><span class="n">distance</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">              <span class="p">}</span>
</span></span><span class="line"><span class="cl">          <span class="p">}</span>
</span></span><span class="line"><span class="cl">          <span class="c1">//4.限制線速度最大值
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>          <span class="k">if</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">linear</span><span class="p">.</span><span class="n">x</span><span class="o">&gt;</span><span class="n">max_speed_</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="p">{</span>
</span></span><span class="line"><span class="cl">              <span class="n">msg</span><span class="p">.</span><span class="n">linear</span><span class="p">.</span><span class="n">x</span><span class="o">=</span><span class="n">max_speed_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">          <span class="p">}</span>
</span></span><span class="line"><span class="cl">          <span class="n">publisher_</span><span class="o">-&gt;</span><span class="n">publish</span><span class="p">(</span><span class="n">msg</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span><span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[])</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">rclcpp</span><span class="o">::</span><span class="n">init</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span><span class="n">argv</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="k">auto</span> <span class="n">node</span> <span class="o">=</span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">TurtrlControlNode</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&#34;turtle_control&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="n">rclcpp</span><span class="o">::</span><span class="n">spin</span><span class="p">(</span><span class="n">node</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="n">rclcpp</span><span class="o">::</span><span class="n">shutdown</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>之后再cmakelist文件中添加依赖已经需要生成的可执行文件已经拷贝内容3个部分，之后就可以正常地colcon已经source，测试需要开启小海龟节点，可以再开一个rqt可视化工具来发布request服务的接口内容，观察是否能控制小海龟运动既可</li>
</ul>
</li>
</ul>
</li>
<li>(客户端)在src的demo_cpp_service下新建一个patrol_client.cpp，代码示例：
<ul>
<li>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl">  <span class="cp">#include</span> <span class="cpf">&#34;rclcpp/rclcpp.hpp&#34;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>  <span class="cp">#include</span> <span class="cpf">&lt;chrono&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>  <span class="cp">#include</span> <span class="cpf">&#34;chapt4_interfaces/srv/patrol.hpp&#34;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>  <span class="cp">#include</span> <span class="cpf">&lt;ctime&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>  <span class="k">using</span> <span class="n">Patrol</span><span class="o">=</span><span class="n">chapt4_interfaces</span><span class="o">::</span><span class="n">srv</span><span class="o">::</span><span class="n">Patrol</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono_literals</span><span class="p">;</span> <span class="c1">//定义之后可以使用10s,100ms
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="k">class</span> <span class="nc">PatrolClient</span><span class="o">:</span><span class="k">public</span> <span class="n">rclcpp</span><span class="o">::</span><span class="n">Node</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">private</span><span class="o">:</span>    
</span></span><span class="line"><span class="cl">      <span class="n">rclcpp</span><span class="o">::</span><span class="n">TimerBase</span><span class="o">::</span><span class="n">SharedPtr</span> <span class="n">timer_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="n">rclcpp</span><span class="o">::</span><span class="n">Client</span><span class="o">&lt;</span><span class="n">Patrol</span><span class="o">&gt;::</span><span class="n">SharedPtr</span> <span class="n">patrol_client_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">      <span class="k">explicit</span> <span class="n">PatrolClient</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">node_name</span><span class="p">)</span><span class="o">:</span><span class="n">Node</span><span class="p">(</span><span class="n">node_name</span><span class="p">)</span> <span class="c1">//加入explicit关键字是防止类进行单参数隐式转换 此处只有一个参数可以被直接使用赋值构造，但是不要允许这样发生，提高代码的可维护性
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="n">srand</span><span class="p">(</span><span class="n">time</span><span class="p">(</span><span class="nb">NULL</span><span class="p">));</span> <span class="c1">//初始化随机数种子
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>          <span class="n">patrol_client_</span><span class="o">=</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">create_client</span><span class="o">&lt;</span><span class="n">Patrol</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&#34;patrol&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">          <span class="n">timer_</span><span class="o">=</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">create_wall_timer</span><span class="p">(</span><span class="mi">10</span><span class="n">s</span><span class="p">,[</span><span class="o">&amp;</span><span class="p">]()</span><span class="o">-&gt;</span><span class="kt">void</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">              <span class="c1">//1.检测服务端是否上线
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>              <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">patrol_client_</span><span class="o">-&gt;</span><span class="n">wait_for_service</span><span class="p">(</span><span class="mi">1</span><span class="n">s</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">              <span class="p">{</span>
</span></span><span class="line"><span class="cl">                  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">rclcpp</span><span class="o">::</span><span class="n">ok</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">                  <span class="p">{</span>
</span></span><span class="line"><span class="cl">                      <span class="n">RCLCPP_ERROR</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">get_logger</span><span class="p">(),</span><span class="s">&#34;等待服务上线中，rclcpp挂了。臣退下了&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                      <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                  <span class="p">}</span>
</span></span><span class="line"><span class="cl">                  <span class="n">RCLCPP_INFO</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">get_logger</span><span class="p">(),</span><span class="s">&#34;等待服务上线中......&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">              <span class="p">}</span>
</span></span><span class="line"><span class="cl">              <span class="c1">//2.构造请求的对象
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>              <span class="k">auto</span> <span class="n">request</span><span class="o">=</span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">Patrol</span><span class="o">::</span><span class="n">Request</span><span class="o">&gt;</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">              <span class="n">request</span><span class="o">-&gt;</span><span class="n">target_x</span><span class="o">=</span><span class="n">rand</span><span class="p">()</span><span class="o">%</span><span class="mi">12</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">              <span class="n">request</span><span class="o">-&gt;</span><span class="n">target_y</span><span class="o">=</span><span class="n">rand</span><span class="p">()</span><span class="o">%</span><span class="mi">12</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">              <span class="n">RCLCPP_INFO</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">get_logger</span><span class="p">(),</span><span class="s">&#34;准备好目标点：%f,%f&#34;</span><span class="p">,</span><span class="n">request</span><span class="o">-&gt;</span><span class="n">target_x</span><span class="p">,</span><span class="n">request</span><span class="o">-&gt;</span><span class="n">target_y</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">              <span class="c1">//3.发送请求
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>              <span class="k">this</span><span class="o">-&gt;</span><span class="n">patrol_client_</span><span class="o">-&gt;</span><span class="n">async_send_request</span><span class="p">(</span><span class="n">request</span><span class="p">,[</span><span class="o">&amp;</span><span class="p">](</span><span class="n">rclcpp</span><span class="o">::</span><span class="n">Client</span><span class="o">&lt;</span><span class="n">Patrol</span><span class="o">&gt;::</span><span class="n">SharedFuture</span> <span class="n">result_future</span><span class="p">)</span><span class="o">-&gt;</span><span class="kt">void</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">                  <span class="k">auto</span> <span class="n">response</span> <span class="o">=</span><span class="n">result_future</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">                  <span class="k">if</span><span class="p">(</span><span class="n">response</span><span class="o">-&gt;</span><span class="n">result</span><span class="o">==</span><span class="n">Patrol</span><span class="o">::</span><span class="n">Response</span><span class="o">::</span><span class="n">SUCESS</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                  <span class="p">{</span>
</span></span><span class="line"><span class="cl">                      <span class="n">RCLCPP_INFO</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">get_logger</span><span class="p">(),</span><span class="s">&#34;请求巡逻目标点成功！&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                  <span class="p">}</span>
</span></span><span class="line"><span class="cl">                  <span class="k">if</span><span class="p">(</span><span class="n">response</span><span class="o">-&gt;</span><span class="n">result</span><span class="o">==</span><span class="n">Patrol</span><span class="o">::</span><span class="n">Response</span><span class="o">::</span><span class="n">FAIL</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                  <span class="p">{</span>
</span></span><span class="line"><span class="cl">                      <span class="n">RCLCPP_INFO</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">get_logger</span><span class="p">(),</span><span class="s">&#34;请求巡逻目标点失败....&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                  <span class="p">}</span>                
</span></span><span class="line"><span class="cl">              <span class="p">});</span>
</span></span><span class="line"><span class="cl">          <span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span><span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[])</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">rclcpp</span><span class="o">::</span><span class="n">init</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span><span class="n">argv</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="k">auto</span> <span class="n">node</span> <span class="o">=</span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">PatrolClient</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&#34;patrol_client_node&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="n">rclcpp</span><span class="o">::</span><span class="n">spin</span><span class="p">(</span><span class="n">node</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="n">rclcpp</span><span class="o">::</span><span class="n">shutdown</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>之后修改cmakelist配置文件然后正常地colcon既可，之后正常运行先运行海龟node然后再把服务端的节点开启，最后开启客户端就可以看到小海龟自动动起来了：</li>
</ul>
</li>
</ul>
</li>
<li>
<p>参数相关</p>
<ul>
<li>参数声明配置
<ul>
<li>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">  <span class="c1">#参数声明 名称＋值</span>
</span></span><span class="line"><span class="cl">  <span class="bp">self</span><span class="o">.</span><span class="n">declare_parameter</span><span class="p">(</span><span class="s1">&#39;number_of_times_to_upsample&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="bp">self</span><span class="o">.</span><span class="n">declare_parameter</span><span class="p">(</span><span class="s1">&#39;model&#39;</span><span class="p">,</span><span class="s1">&#39;hog&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="c1">#参数值获取</span>
</span></span><span class="line"><span class="cl">  <span class="bp">self</span><span class="o">.</span><span class="n">number_of_times_to_upsample</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span><span class="s1">&#39;number_of_times_to_upsample&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
</span></span><span class="line"><span class="cl">  <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span><span class="s1">&#39;model&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"></code></pre></td></tr></table>
</div>
</div></li>
<li>参数使用和更改：
<ul>
<li>运行节点时可指令更改参数值：
<ul>
<li>ros2 run demo_python_service face_detect_node &ndash;ros-args -p model:=cnn</li>
</ul>
</li>
<li>可在新终端先运行查看当前参数list：ros2 param list
<ul>
<li>随后可运行类似set参数值：ros2 param set /face_detect_node number_of_times_to_upsample 2</li>
<li>也可以get参数值：ros2 param get /face_detect_node model</li>
</ul>
</li>
</ul>
</li>
<li>C++接收参数事件
<ul>
<li>创建参数并且可以代码内部修改参数值，也可以动态rqt设置参数，通过设置响应设置参数的回调函数来动态设置参数数值并且赋值给代码中的其他参数
<ul>
<li>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl">  <span class="cp">#include</span> <span class="cpf">&#34;rclcpp/rclcpp.hpp&#34;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>  <span class="cp">#include</span> <span class="cpf">&#34;geometry_msgs/msg/twist.hpp&#34;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>  <span class="cp">#include</span> <span class="cpf">&lt;chrono&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>  <span class="cp">#include</span> <span class="cpf">&#34;turtlesim/msg/pose.hpp&#34;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>  <span class="cp">#include</span> <span class="cpf">&#34;chapt4_interfaces/srv/patrol.hpp&#34;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>  <span class="cp">#include</span> <span class="cpf">&#34;rcl_interfaces/msg/set_parameters_result.hpp&#34;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl">  <span class="k">using</span> <span class="n">SetParametersResult</span><span class="o">=</span><span class="n">rcl_interfaces</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">SetParametersResult</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">using</span> <span class="n">Patrol</span><span class="o">=</span><span class="n">chapt4_interfaces</span><span class="o">::</span><span class="n">srv</span><span class="o">::</span><span class="n">Patrol</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono_literals</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">class</span> <span class="nc">TurtrlControlNode</span><span class="o">:</span><span class="k">public</span> <span class="n">rclcpp</span><span class="o">::</span><span class="n">Node</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">private</span><span class="o">:</span>    
</span></span><span class="line"><span class="cl">      <span class="n">OnSetParametersCallbackHandle</span><span class="o">::</span><span class="n">SharedPtr</span> <span class="n">parameter_callback_handle_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="n">rclcpp</span><span class="o">::</span><span class="n">Service</span><span class="o">&lt;</span><span class="n">Patrol</span><span class="o">&gt;::</span><span class="n">SharedPtr</span> <span class="n">patrol_service_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="n">rclcpp</span><span class="o">::</span><span class="n">Publisher</span><span class="o">&lt;</span><span class="n">geometry_msgs</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">Twist</span><span class="o">&gt;::</span><span class="n">SharedPtr</span> <span class="n">publisher_</span><span class="p">;</span> <span class="c1">//发布者的智能指针
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="n">rclcpp</span><span class="o">::</span><span class="n">Subscription</span><span class="o">&lt;</span><span class="n">turtlesim</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">Pose</span><span class="o">&gt;::</span><span class="n">SharedPtr</span> <span class="n">subscription_</span><span class="p">;</span><span class="c1">//訂閱者的智能指針
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="kt">double</span> <span class="n">target_x_</span><span class="p">{</span><span class="mf">1.0</span><span class="p">};</span><span class="c1">//目標位置x座標
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="kt">double</span> <span class="n">target_y_</span><span class="p">{</span><span class="mf">1.0</span><span class="p">};</span> <span class="c1">//目標位置y座標
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="kt">double</span> <span class="n">k_</span><span class="p">{</span><span class="mf">1.0</span><span class="p">};</span> <span class="c1">// 比例係數
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="kt">double</span> <span class="n">max_speed_</span><span class="p">{</span><span class="mf">3.0</span><span class="p">};</span> <span class="c1">//最大速度
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">      <span class="k">explicit</span> <span class="n">TurtrlControlNode</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">node_name</span><span class="p">)</span><span class="o">:</span><span class="n">Node</span><span class="p">(</span><span class="n">node_name</span><span class="p">)</span> <span class="c1">//加入explicit关键字是防止类进行单参数隐式转换 此处只有一个参数可以被直接使用赋值构造，但是不要允许这样发生，提高代码的可维护性
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="p">{</span>     
</span></span><span class="line"><span class="cl">          <span class="k">this</span><span class="o">-&gt;</span><span class="n">declare_parameter</span><span class="p">(</span><span class="s">&#34;k&#34;</span><span class="p">,</span><span class="mf">1.0</span><span class="p">);</span> <span class="c1">//创建参数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>          <span class="k">this</span><span class="o">-&gt;</span><span class="n">declare_parameter</span><span class="p">(</span><span class="s">&#34;max_speed&#34;</span><span class="p">,</span><span class="mf">1.0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">          <span class="k">this</span><span class="o">-&gt;</span><span class="n">get_parameter</span><span class="p">(</span><span class="s">&#34;k&#34;</span><span class="p">,</span><span class="n">k_</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">          <span class="k">this</span><span class="o">-&gt;</span><span class="n">get_parameter</span><span class="p">(</span><span class="s">&#34;max_speed&#34;</span><span class="p">,</span><span class="n">max_speed_</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">          <span class="k">this</span><span class="o">-&gt;</span><span class="n">set_parameter</span><span class="p">(</span><span class="n">rclcpp</span><span class="o">::</span><span class="n">Parameter</span><span class="p">(</span><span class="s">&#34;k&#34;</span><span class="p">,</span><span class="mf">2.0</span><span class="p">));</span>  <span class="c1">//内部修改参数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">          <span class="c1">//响应回调函数动态接收参数修改
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>          <span class="n">parameter_callback_handle_</span><span class="o">=</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">add_on_set_parameters_callback</span><span class="p">([</span><span class="o">&amp;</span><span class="p">]</span> 
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">rclcpp</span><span class="o">::</span><span class="n">Parameter</span><span class="o">&gt;</span> <span class="o">&amp;</span> <span class="n">parameters</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="o">-&gt;</span><span class="n">rcl_interfaces</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">SetParametersResult</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">              <span class="n">rcl_interfaces</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">SetParametersResult</span> <span class="n">result</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">              <span class="n">result</span><span class="p">.</span><span class="n">successful</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">              <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="k">auto</span> <span class="o">&amp;</span> <span class="nl">parameter</span> <span class="p">:</span> <span class="n">parameters</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">              <span class="p">{</span>
</span></span><span class="line"><span class="cl">                  <span class="n">RCLCPP_INFO</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">get_logger</span><span class="p">(),</span><span class="s">&#34;更新参数的值%s=%f&#34;</span><span class="p">,</span><span class="n">parameter</span><span class="p">.</span><span class="n">get_name</span><span class="p">().</span><span class="n">c_str</span><span class="p">(),</span><span class="n">parameter</span><span class="p">.</span><span class="n">as_double</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">                  <span class="k">if</span><span class="p">(</span><span class="n">parameter</span><span class="p">.</span><span class="n">get_name</span><span class="p">()</span><span class="o">==</span><span class="s">&#34;k&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                  <span class="p">{</span>
</span></span><span class="line"><span class="cl">                      <span class="n">k_</span><span class="o">=</span><span class="n">parameter</span><span class="p">.</span><span class="n">as_double</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">                  <span class="p">}</span>
</span></span><span class="line"><span class="cl">                  <span class="k">if</span><span class="p">(</span><span class="n">parameter</span><span class="p">.</span><span class="n">get_name</span><span class="p">()</span><span class="o">==</span><span class="s">&#34;max_speed&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                  <span class="p">{</span>
</span></span><span class="line"><span class="cl">                      <span class="n">max_speed_</span><span class="o">=</span><span class="n">parameter</span><span class="p">.</span><span class="n">as_double</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">                  <span class="p">}</span>
</span></span><span class="line"><span class="cl">              <span class="p">}</span>
</span></span><span class="line"><span class="cl">              <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">          <span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">          <span class="n">patrol_service_</span><span class="o">=</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">create_service</span><span class="o">&lt;</span><span class="n">Patrol</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&#34;patrol&#34;</span><span class="p">,[</span><span class="o">&amp;</span><span class="p">](</span><span class="k">const</span> <span class="n">Patrol</span><span class="o">::</span><span class="n">Request</span><span class="o">::</span><span class="n">SharedPtr</span> <span class="n">request</span><span class="p">,</span><span class="n">Patrol</span><span class="o">::</span><span class="n">Response</span><span class="o">::</span><span class="n">SharedPtr</span> <span class="n">response</span><span class="p">)</span><span class="o">-&gt;</span><span class="kt">void</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">              <span class="k">if</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                  <span class="p">(</span><span class="mi">0</span><span class="o">&lt;</span><span class="n">request</span><span class="o">-&gt;</span><span class="n">target_x</span><span class="o">&amp;&amp;</span><span class="n">request</span><span class="o">-&gt;</span><span class="n">target_x</span><span class="o">&lt;</span><span class="mf">12.0f</span><span class="p">)</span><span class="o">&amp;&amp;</span>
</span></span><span class="line"><span class="cl">                  <span class="p">(</span><span class="mi">0</span><span class="o">&lt;</span><span class="n">request</span><span class="o">-&gt;</span><span class="n">target_y</span><span class="o">&amp;&amp;</span><span class="n">request</span><span class="o">-&gt;</span><span class="n">target_y</span><span class="o">&lt;</span><span class="mf">12.0f</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">              <span class="p">)</span>
</span></span><span class="line"><span class="cl">              <span class="p">{</span>
</span></span><span class="line"><span class="cl">                  <span class="k">this</span><span class="o">-&gt;</span><span class="n">target_x_</span><span class="o">=</span><span class="n">request</span><span class="o">-&gt;</span><span class="n">target_x</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                  <span class="k">this</span><span class="o">-&gt;</span><span class="n">target_y_</span><span class="o">=</span><span class="n">request</span><span class="o">-&gt;</span><span class="n">target_y</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                  <span class="n">response</span><span class="o">-&gt;</span><span class="n">result</span><span class="o">=</span><span class="n">Patrol</span><span class="o">::</span><span class="n">Response</span><span class="o">::</span><span class="n">SUCESS</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">              <span class="p">}</span>
</span></span><span class="line"><span class="cl">              <span class="k">else</span>
</span></span><span class="line"><span class="cl">              <span class="p">{</span>
</span></span><span class="line"><span class="cl">                  <span class="n">response</span><span class="o">-&gt;</span><span class="n">result</span><span class="o">=</span><span class="n">Patrol</span><span class="o">::</span><span class="n">Response</span><span class="o">::</span><span class="n">FAIL</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">              <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">          <span class="p">});</span>
</span></span><span class="line"><span class="cl">          <span class="n">publisher_</span><span class="o">=</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">create_publisher</span><span class="o">&lt;</span><span class="n">geometry_msgs</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">Twist</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&#34;/turtle1/cmd_vel&#34;</span><span class="p">,</span><span class="mi">10</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">          <span class="c1">// timer_=this-&gt;create_wall_timer(1000ms,std::bind(&amp;TurtrlControlNode::timer_callback,this));
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>          <span class="n">subscription_</span><span class="o">=</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">create_subscription</span><span class="o">&lt;</span><span class="n">turtlesim</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">Pose</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&#34;/turtle1/pose&#34;</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">bind</span><span class="p">(</span><span class="o">&amp;</span><span class="n">TurtrlControlNode</span><span class="o">::</span><span class="n">on_pose_recevied</span><span class="p">,</span><span class="k">this</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">placeholders</span><span class="o">::</span><span class="n">_1</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="kt">void</span> <span class="nf">on_pose_recevied</span><span class="p">(</span><span class="k">const</span> <span class="n">turtlesim</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">Pose</span><span class="o">::</span><span class="n">SharedPtr</span> <span class="n">pose</span><span class="p">)</span> <span class="c1">//參數：收到數據的共享指針
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="c1">//1.獲取當前位置
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>          <span class="k">auto</span> <span class="n">current_x</span><span class="o">=</span><span class="n">pose</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">          <span class="k">auto</span> <span class="n">current_y</span><span class="o">=</span><span class="n">pose</span><span class="o">-&gt;</span><span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">          <span class="n">RCLCPP_INFO</span><span class="p">(</span><span class="n">get_logger</span><span class="p">(),</span><span class="s">&#34;當前的：x=%f,y=%f&#34;</span><span class="p">,</span><span class="n">current_x</span><span class="p">,</span><span class="n">current_y</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">          <span class="c1">//2.計算當前的位置和目標位置的距離和朝向的差
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>          <span class="k">auto</span> <span class="n">distance</span><span class="o">=</span><span class="n">std</span><span class="o">::</span><span class="n">sqrt</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">              <span class="p">(</span><span class="n">target_x_</span><span class="o">-</span><span class="n">current_x</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">target_x_</span><span class="o">-</span><span class="n">current_x</span><span class="p">)</span><span class="o">+</span>
</span></span><span class="line"><span class="cl">              <span class="p">(</span><span class="n">target_y_</span><span class="o">-</span><span class="n">current_y</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">target_y_</span><span class="o">-</span><span class="n">current_y</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="p">);</span>
</span></span><span class="line"><span class="cl">          <span class="k">auto</span> <span class="n">angle</span><span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">atan2</span><span class="p">((</span><span class="n">target_y_</span><span class="o">-</span><span class="n">current_y</span><span class="p">),(</span><span class="n">target_x_</span><span class="o">-</span><span class="n">current_x</span><span class="p">))</span> <span class="o">-</span> <span class="n">pose</span><span class="o">-&gt;</span><span class="n">theta</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">          <span class="c1">//3.利用角度差和位置差輸出控制
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>          <span class="k">auto</span> <span class="n">msg</span><span class="o">=</span><span class="n">geometry_msgs</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">Twist</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">          <span class="k">if</span><span class="p">(</span><span class="n">distance</span><span class="o">&gt;</span><span class="mf">0.2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="p">{</span>
</span></span><span class="line"><span class="cl">              <span class="k">if</span><span class="p">(</span><span class="n">fabs</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span><span class="o">&gt;</span><span class="mf">0.2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">              <span class="p">{</span>
</span></span><span class="line"><span class="cl">                  <span class="n">msg</span><span class="p">.</span><span class="n">angular</span><span class="p">.</span><span class="n">z</span><span class="o">=</span><span class="n">fabs</span><span class="p">(</span><span class="n">angle</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">              <span class="p">}</span>
</span></span><span class="line"><span class="cl">              <span class="k">else</span>
</span></span><span class="line"><span class="cl">              <span class="p">{</span>
</span></span><span class="line"><span class="cl">                  <span class="n">msg</span><span class="p">.</span><span class="n">linear</span><span class="p">.</span><span class="n">x</span><span class="o">=</span><span class="n">k_</span><span class="o">*</span><span class="n">distance</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">              <span class="p">}</span>
</span></span><span class="line"><span class="cl">          <span class="p">}</span>
</span></span><span class="line"><span class="cl">          <span class="c1">//4.限制線速度最大值
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>          <span class="k">if</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">linear</span><span class="p">.</span><span class="n">x</span><span class="o">&gt;</span><span class="n">max_speed_</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="p">{</span>
</span></span><span class="line"><span class="cl">              <span class="n">msg</span><span class="p">.</span><span class="n">linear</span><span class="p">.</span><span class="n">x</span><span class="o">=</span><span class="n">max_speed_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">          <span class="p">}</span>
</span></span><span class="line"><span class="cl">          <span class="n">publisher_</span><span class="o">-&gt;</span><span class="n">publish</span><span class="p">(</span><span class="n">msg</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span><span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[])</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">rclcpp</span><span class="o">::</span><span class="n">init</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span><span class="n">argv</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="k">auto</span> <span class="n">node</span> <span class="o">=</span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">TurtrlControlNode</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&#34;turtle_control&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="n">rclcpp</span><span class="o">::</span><span class="n">spin</span><span class="p">(</span><span class="n">node</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="n">rclcpp</span><span class="o">::</span><span class="n">shutdown</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>代码跑通后直接在rqt中parameter reconfigure动态修改节点中的对应设置好的k和max_speed的值，随后查看终端是否打印修改成功信息</li>
</ul>
</li>
</ul>
</li>
<li>C++修改其他节点的参数
<ul>
<li>分别新建客户端用于发送请求，以及新建更新参数值函数，主函数调用更新参数值函数即可，代码示例中主要是设置k的参数值，如果需要修改其他参数值直接新建设置函数即可，主要如下：
<ul>
<li>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl">  <span class="cp">#include</span> <span class="cpf">&#34;rclcpp/rclcpp.hpp&#34;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>  <span class="cp">#include</span> <span class="cpf">&lt;chrono&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>  <span class="cp">#include</span> <span class="cpf">&#34;chapt4_interfaces/srv/patrol.hpp&#34;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>  <span class="cp">#include</span> <span class="cpf">&lt;ctime&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>  <span class="cp">#include</span> <span class="cpf">&#34;rcl_interfaces/msg/parameter.hpp&#34;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>  <span class="cp">#include</span> <span class="cpf">&#34;rcl_interfaces/msg/parameter_value.hpp&#34;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>  <span class="cp">#include</span> <span class="cpf">&#34;rcl_interfaces/msg/parameter_type.hpp&#34;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>  <span class="cp">#include</span> <span class="cpf">&#34;rcl_interfaces/srv/set_parameters.hpp&#34;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl">  <span class="k">using</span> <span class="n">SetP</span><span class="o">=</span><span class="n">rcl_interfaces</span><span class="o">::</span><span class="n">srv</span><span class="o">::</span><span class="n">SetParameters</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">using</span> <span class="n">Patrol</span><span class="o">=</span><span class="n">chapt4_interfaces</span><span class="o">::</span><span class="n">srv</span><span class="o">::</span><span class="n">Patrol</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono_literals</span><span class="p">;</span> <span class="c1">//定义之后可以使用10s,100ms
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="k">class</span> <span class="nc">PatrolClient</span><span class="o">:</span><span class="k">public</span> <span class="n">rclcpp</span><span class="o">::</span><span class="n">Node</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">private</span><span class="o">:</span>    
</span></span><span class="line"><span class="cl">      <span class="n">rclcpp</span><span class="o">::</span><span class="n">TimerBase</span><span class="o">::</span><span class="n">SharedPtr</span> <span class="n">timer_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="n">rclcpp</span><span class="o">::</span><span class="n">Client</span><span class="o">&lt;</span><span class="n">Patrol</span><span class="o">&gt;::</span><span class="n">SharedPtr</span> <span class="n">patrol_client_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">      <span class="k">explicit</span> <span class="n">PatrolClient</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">node_name</span><span class="p">)</span><span class="o">:</span><span class="n">Node</span><span class="p">(</span><span class="n">node_name</span><span class="p">)</span> <span class="c1">//加入explicit关键字是防止类进行单参数隐式转换 此处只有一个参数可以被直接使用赋值构造，但是不要允许这样发生，提高代码的可维护性
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="n">srand</span><span class="p">(</span><span class="n">time</span><span class="p">(</span><span class="nb">NULL</span><span class="p">));</span> <span class="c1">//初始化随机数种子
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>          <span class="n">patrol_client_</span><span class="o">=</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">create_client</span><span class="o">&lt;</span><span class="n">Patrol</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&#34;patrol&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">          <span class="n">timer_</span><span class="o">=</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">create_wall_timer</span><span class="p">(</span><span class="mi">10</span><span class="n">s</span><span class="p">,[</span><span class="o">&amp;</span><span class="p">]()</span><span class="o">-&gt;</span><span class="kt">void</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">              <span class="c1">//1.检测服务端是否上线
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>              <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">patrol_client_</span><span class="o">-&gt;</span><span class="n">wait_for_service</span><span class="p">(</span><span class="mi">1</span><span class="n">s</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">              <span class="p">{</span>
</span></span><span class="line"><span class="cl">                  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">rclcpp</span><span class="o">::</span><span class="n">ok</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">                  <span class="p">{</span>
</span></span><span class="line"><span class="cl">                      <span class="n">RCLCPP_ERROR</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">get_logger</span><span class="p">(),</span><span class="s">&#34;等待服务上线中，rclcpp挂了。臣退下了&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                      <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                  <span class="p">}</span>
</span></span><span class="line"><span class="cl">                  <span class="n">RCLCPP_INFO</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">get_logger</span><span class="p">(),</span><span class="s">&#34;等待服务上线中......&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">              <span class="p">}</span>
</span></span><span class="line"><span class="cl">              <span class="c1">//2.构造请求的对象
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>              <span class="k">auto</span> <span class="n">request</span><span class="o">=</span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">Patrol</span><span class="o">::</span><span class="n">Request</span><span class="o">&gt;</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">              <span class="n">request</span><span class="o">-&gt;</span><span class="n">target_x</span><span class="o">=</span><span class="n">rand</span><span class="p">()</span><span class="o">%</span><span class="mi">12</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">              <span class="n">request</span><span class="o">-&gt;</span><span class="n">target_y</span><span class="o">=</span><span class="n">rand</span><span class="p">()</span><span class="o">%</span><span class="mi">12</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">              <span class="n">RCLCPP_INFO</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">get_logger</span><span class="p">(),</span><span class="s">&#34;准备好目标点：%f,%f&#34;</span><span class="p">,</span><span class="n">request</span><span class="o">-&gt;</span><span class="n">target_x</span><span class="p">,</span><span class="n">request</span><span class="o">-&gt;</span><span class="n">target_y</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">              <span class="c1">//3.发送请求
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>              <span class="k">this</span><span class="o">-&gt;</span><span class="n">patrol_client_</span><span class="o">-&gt;</span><span class="n">async_send_request</span><span class="p">(</span><span class="n">request</span><span class="p">,[</span><span class="o">&amp;</span><span class="p">](</span><span class="n">rclcpp</span><span class="o">::</span><span class="n">Client</span><span class="o">&lt;</span><span class="n">Patrol</span><span class="o">&gt;::</span><span class="n">SharedFuture</span> <span class="n">result_future</span><span class="p">)</span><span class="o">-&gt;</span><span class="kt">void</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">                  <span class="k">auto</span> <span class="n">response</span> <span class="o">=</span><span class="n">result_future</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">                  <span class="k">if</span><span class="p">(</span><span class="n">response</span><span class="o">-&gt;</span><span class="n">result</span><span class="o">==</span><span class="n">Patrol</span><span class="o">::</span><span class="n">Response</span><span class="o">::</span><span class="n">SUCESS</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                  <span class="p">{</span>
</span></span><span class="line"><span class="cl">                      <span class="n">RCLCPP_INFO</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">get_logger</span><span class="p">(),</span><span class="s">&#34;请求巡逻目标点成功！&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                  <span class="p">}</span>
</span></span><span class="line"><span class="cl">                  <span class="k">if</span><span class="p">(</span><span class="n">response</span><span class="o">-&gt;</span><span class="n">result</span><span class="o">==</span><span class="n">Patrol</span><span class="o">::</span><span class="n">Response</span><span class="o">::</span><span class="n">FAIL</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                  <span class="p">{</span>
</span></span><span class="line"><span class="cl">                      <span class="n">RCLCPP_INFO</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">get_logger</span><span class="p">(),</span><span class="s">&#34;请求巡逻目标点失败....&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                  <span class="p">}</span>                
</span></span><span class="line"><span class="cl">              <span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">          <span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm">      * 创建客户端发送请求，并且返回结果
</span></span></span><span class="line"><span class="cl"><span class="cm">      */</span>
</span></span><span class="line"><span class="cl">      <span class="n">SetP</span><span class="o">::</span><span class="n">Response</span><span class="o">::</span><span class="n">SharedPtr</span> <span class="n">call_set_parameters</span><span class="p">(</span><span class="k">const</span> <span class="n">rcl_interfaces</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">Parameter</span> <span class="o">&amp;</span><span class="n">param</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="k">auto</span> <span class="n">param_client</span><span class="o">=</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">create_client</span><span class="o">&lt;</span><span class="n">SetP</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&#34;/turtle_control/set_parameters&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">              <span class="c1">//1.检测服务端是否上线
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>              <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">param_client</span><span class="o">-&gt;</span><span class="n">wait_for_service</span><span class="p">(</span><span class="mi">1</span><span class="n">s</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">              <span class="p">{</span>
</span></span><span class="line"><span class="cl">                  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">rclcpp</span><span class="o">::</span><span class="n">ok</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">                  <span class="p">{</span>
</span></span><span class="line"><span class="cl">                      <span class="n">RCLCPP_ERROR</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">get_logger</span><span class="p">(),</span><span class="s">&#34;等待第二个set_param服务上线中，rclcpp挂了。臣退下了&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                      <span class="k">return</span> <span class="k">nullptr</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                  <span class="p">}</span>
</span></span><span class="line"><span class="cl">                  <span class="n">RCLCPP_INFO</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">get_logger</span><span class="p">(),</span><span class="s">&#34;等待服务上线中......&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">              <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">              <span class="c1">//2.构造请求的对象
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>              <span class="k">auto</span> <span class="n">request</span><span class="o">=</span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">SetP</span><span class="o">::</span><span class="n">Request</span><span class="o">&gt;</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">              <span class="n">request</span><span class="o">-&gt;</span><span class="n">parameters</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">param</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">              <span class="c1">//3.发送请求
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>              <span class="k">auto</span> <span class="n">furture</span><span class="o">=</span><span class="n">param_client</span><span class="o">-&gt;</span><span class="n">async_send_request</span><span class="p">(</span><span class="n">request</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">              <span class="n">rclcpp</span><span class="o">::</span><span class="n">spin_until_future_complete</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">get_node_base_interface</span><span class="p">(),</span><span class="n">furture</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">              <span class="k">auto</span> <span class="n">response</span><span class="o">=</span><span class="n">furture</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">              <span class="k">return</span> <span class="n">response</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm">      * 更新参数值
</span></span></span><span class="line"><span class="cl"><span class="cm">      */</span>
</span></span><span class="line"><span class="cl">      <span class="kt">void</span> <span class="nf">update_server_param_k</span><span class="p">(</span><span class="kt">double</span> <span class="n">k</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="c1">//1.创建一个参数对象
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>          <span class="k">auto</span> <span class="n">param</span><span class="o">=</span><span class="n">rcl_interfaces</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">Parameter</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">          <span class="n">param</span><span class="p">.</span><span class="n">name</span><span class="o">=</span><span class="s">&#34;k&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">          <span class="c1">//2.创建参数值
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>          <span class="k">auto</span> <span class="n">param_value</span><span class="o">=</span><span class="n">rcl_interfaces</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">ParameterValue</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">          <span class="n">param_value</span><span class="p">.</span><span class="n">type</span><span class="o">=</span><span class="n">rcl_interfaces</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">ParameterType</span><span class="o">::</span><span class="n">PARAMETER_DOUBLE</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">          <span class="n">param_value</span><span class="p">.</span><span class="n">double_value</span><span class="o">=</span><span class="n">k</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">          <span class="n">param</span><span class="p">.</span><span class="n">value</span><span class="o">=</span><span class="n">param_value</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">          <span class="c1">//3.请求更新参赛
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>          <span class="k">auto</span> <span class="n">response</span><span class="o">=</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">call_set_parameters</span><span class="p">(</span><span class="n">param</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">          <span class="k">if</span><span class="p">(</span><span class="n">response</span><span class="o">==</span><span class="nb">NULL</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="p">{</span>
</span></span><span class="line"><span class="cl">              <span class="n">RCLCPP_INFO</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">get_logger</span><span class="p">(),</span><span class="s">&#34;参数返回失败&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">              <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">          <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">          <span class="k">for</span><span class="p">(</span><span class="k">auto</span> <span class="nl">result</span><span class="p">:</span><span class="n">response</span><span class="o">-&gt;</span><span class="n">results</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="p">{</span>
</span></span><span class="line"><span class="cl">              <span class="k">if</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">successful</span><span class="o">==</span><span class="nb">false</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">              <span class="p">{</span>
</span></span><span class="line"><span class="cl">                  <span class="n">RCLCPP_INFO</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">get_logger</span><span class="p">(),</span><span class="s">&#34;参数返回失败，原因是：%s&#34;</span><span class="p">,</span><span class="n">result</span><span class="p">.</span><span class="n">reason</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">              <span class="p">}</span>
</span></span><span class="line"><span class="cl">              <span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">                  <span class="n">RCLCPP_INFO</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">get_logger</span><span class="p">(),</span><span class="s">&#34;参数返回成功&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">              <span class="p">}</span>
</span></span><span class="line"><span class="cl">          <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span><span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[])</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">rclcpp</span><span class="o">::</span><span class="n">init</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span><span class="n">argv</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="k">auto</span> <span class="n">node</span> <span class="o">=</span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">PatrolClient</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&#34;patrol_client_node&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="n">node</span><span class="o">-&gt;</span><span class="n">update_server_param_k</span><span class="p">(</span><span class="mf">5.0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="n">rclcpp</span><span class="o">::</span><span class="n">spin</span><span class="p">(</span><span class="n">node</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="n">rclcpp</span><span class="o">::</span><span class="n">shutdown</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>写完后编译，先运行上一节的参数声明节点，然后再运行新写的修改参数节点，既可看到终端打印的日志内容是否成功检测到服务上线以及是否修改成功</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>使用launch文件</p>
<ul>
<li>现在想要的功能包下面新建launch文件夹，然后再launch文件夹内新建一个demo.launch.py文件，内容如下：
<ul>
<li>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">  <span class="kn">import</span> <span class="nn">launch</span>
</span></span><span class="line"><span class="cl">  <span class="kn">import</span> <span class="nn">launch_ros</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">def</span> <span class="nf">generate_launch_description</span><span class="p">():</span> <span class="c1">#此函数名是固定的</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;&#34;&#34;产生launch描述&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="n">action_node_turtlesim_node</span><span class="o">=</span><span class="n">launch_ros</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">          <span class="n">package</span><span class="o">=</span><span class="s1">&#39;turtlesim&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="n">executable</span><span class="o">=</span><span class="s1">&#39;turtlesim_node&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="n">output</span><span class="o">=</span><span class="s1">&#39;screen&#39;</span> <span class="c1"># 输出方式一：屏幕</span>
</span></span><span class="line"><span class="cl">      <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="n">action_node_turtle_control</span><span class="o">=</span><span class="n">launch_ros</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">          <span class="n">package</span><span class="o">=</span><span class="s1">&#39;demo_cpp_service&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="n">executable</span><span class="o">=</span><span class="s1">&#39;turtle_control&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="n">output</span><span class="o">=</span><span class="s1">&#39;log&#39;</span> <span class="c1"># 输出方式二：日志文件</span>
</span></span><span class="line"><span class="cl">      <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="n">action_node_patrol_client</span><span class="o">=</span><span class="n">launch_ros</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">          <span class="n">package</span><span class="o">=</span><span class="s1">&#39;demo_cpp_service&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="n">executable</span><span class="o">=</span><span class="s1">&#39;patrol_client&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="n">output</span><span class="o">=</span><span class="s1">&#39;both&#39;</span> <span class="c1"># 输出方式三：上面两种都要</span>
</span></span><span class="line"><span class="cl">      <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="n">launch</span><span class="o">.</span><span class="n">LaunchDescription</span><span class="p">([</span>
</span></span><span class="line"><span class="cl">          <span class="c1"># actions动作</span>
</span></span><span class="line"><span class="cl">          <span class="n">action_node_turtlesim_node</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="n">action_node_turtle_control</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="n">action_node_patrol_client</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="p">])</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>随后更改拷贝的构建配置，在C++中的cmakelist文件中添加下面内容指定拷贝的文件夹名称和文件路径即可：
<ul>
<li>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl">  <span class="c1">// install(DIRECTORY launch
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="c1">// DESTINATION share/${PROJECT_NAME}
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="c1">// )
</span></span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
</li>
<li>在python中的setup.py中添加下面内容，同样指定文件夹和文件路径：
<ul>
<li>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">  <span class="kn">from</span> <span class="nn">setuptools</span> <span class="kn">import</span> <span class="n">find_packages</span><span class="p">,</span> <span class="n">setup</span>
</span></span><span class="line"><span class="cl">  <span class="kn">from</span> <span class="nn">glob</span> <span class="kn">import</span> <span class="n">glob</span>  <span class="c1"># 1.引入此包</span>
</span></span><span class="line"><span class="cl">  <span class="n">package_name</span> <span class="o">=</span> <span class="s1">&#39;demo_python_service&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">setup</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">      <span class="n">name</span><span class="o">=</span><span class="n">package_name</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="n">version</span><span class="o">=</span><span class="s1">&#39;0.0.0&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="n">packages</span><span class="o">=</span><span class="n">find_packages</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">]),</span>
</span></span><span class="line"><span class="cl">      <span class="n">data_files</span><span class="o">=</span><span class="p">[</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="s1">&#39;share/ament_index/resource_index/packages&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">              <span class="p">[</span><span class="s1">&#39;resource/&#39;</span> <span class="o">+</span> <span class="n">package_name</span><span class="p">]),</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="s1">&#39;share/&#39;</span> <span class="o">+</span> <span class="n">package_name</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;package.xml&#39;</span><span class="p">]),</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="s1">&#39;share/&#39;</span> <span class="o">+</span> <span class="n">package_name</span><span class="o">+</span><span class="s2">&#34;/resource&#34;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;resource/defult.jpg&#39;</span><span class="p">]),</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="s1">&#39;share/&#39;</span> <span class="o">+</span> <span class="n">package_name</span><span class="o">+</span><span class="s2">&#34;/resource&#34;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;resource/peoples.jpg&#39;</span><span class="p">]),</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="s1">&#39;share/&#39;</span> <span class="o">+</span> <span class="n">package_name</span><span class="o">+</span><span class="s2">&#34;/launch&#34;</span><span class="p">,</span> <span class="n">glob</span><span class="p">(</span><span class="s1">&#39;launch/*.launch.py&#39;</span><span class="p">)),</span> <span class="c1"># 2.添加指定路径以及文件</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="p">],</span>
</span></span><span class="line"><span class="cl">      <span class="n">install_requires</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;setuptools&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">      <span class="n">zip_safe</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="n">maintainer</span><span class="o">=</span><span class="s1">&#39;robot&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="n">maintainer_email</span><span class="o">=</span><span class="s1">&#39;robot@todo.todo&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="n">description</span><span class="o">=</span><span class="s1">&#39;TODO: Package description&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="n">license</span><span class="o">=</span><span class="s1">&#39;Apache-2.0&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="n">tests_require</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;pytest&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">      <span class="n">entry_points</span><span class="o">=</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="s1">&#39;console_scripts&#39;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">              <span class="s1">&#39;learn_face_detect=demo_python_service.learn_face_detect:main&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">              <span class="s1">&#39;face_detect_node=demo_python_service.face_detect_node:main&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">              <span class="s1">&#39;face_detect_client_node=demo_python_service.face_detect_client_node:main&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">          <span class="p">],</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
</li>
</ul>
</li>
<li>配置好后先colcon build，随后再source完，运行：ros2 launch 功能包名（创建launch文件夹的功能包位置） demo.launch.py</li>
<li>之后就能看到配置的对应节点成功打开</li>
</ul>
</li>
</ul>
<h2 id="4-心得总结">4. 心得总结
</h2><blockquote class="alert alert-note">
    <p>移步完这篇笔记内容才算是把我本地电脑上那个“原始人的CMD笔记”给完全移步完😥，也算是逐步纠正自己的拖延症和懒了😩。其实Linux的学习感觉还是有很多实践和操作需要动手边学边运用才能更好吸收，后面更多的还是带入实际项目中去边学边做！还有后面需要的细分在Linux系统下具体做例如音频，网络等等开发再栏，先学习运用在ROS机器人操作系统上的具体例如自主导航，手眼标定抓取等等，一步一步总会找到属于自己想要的🥱🥱🥱</p></blockquote>

</section>


    <footer class="article-footer">
    

    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>不知江月待何人,但见长江送流水.</span>
    </section>
    </footer>


    
</article>

    

    

     
    
        
    <script
    src="https://giscus.app/client.js"
    data-repo="prominsegsj/prominsegsj.github.io"
    data-repo-id="R_kgDOPjrIrg"
    data-category="Announcements"
    data-category-id="DIC_kwDOPjrIrs4Cuj0b"
    data-mapping="pathname"
    data-strict="0"
    data-reactions-enabled="1"
    data-emit-metadata="0"
    data-input-position="top"
    data-theme="light"
    data-lang="en"
    data-loading=""
    crossorigin="anonymous"
    async
></script>
<script>
    function setGiscusTheme(theme) {
        let giscus = document.querySelector("iframe.giscus-frame");
        if (giscus) {
            giscus.contentWindow.postMessage(
                {
                    giscus: {
                        setConfig: {
                            theme: theme,
                        },
                    },
                },
                "https://giscus.app"
            );
        }
    }

    (function () {
        addEventListener("message", (e) => {
            if (event.origin !== "https://giscus.app") return;
            handler();
        });
        window.addEventListener("onColorSchemeChange", handler);

        function handler() {
            if (document.documentElement.dataset.scheme === "light") {
                setGiscusTheme('light');
            } else {
                setGiscusTheme('dark');
            }
        }
    })();
</script>

    

    
<div class="reading-progress">
    <div class="reading-progress-bar" id="readingProgress"></div>
</div>

<footer class="site-footer">
    <section class="copyright">
        &copy; 
        
        2025 小郭不背锅
    </section>
    
    
    <section class="powerby" style="margin-top: 0.5rem;">
        <div id="site-runtime" style="font-size: 1.15em; color: #290656;">
            本站已安全运行 <span id="runtime-days">0</span> 天 <span id="runtime-hours">0</span> 时 <span id="runtime-mins">0</span> 分 <span id="runtime-secs">0</span> 秒
        </div>
    </section>

    <script>
        
        const startDate = new Date('2025-08-25T12:00:00'); 

        function updateRuntime() {
            const now = new Date();
            const diff = now - startDate; 

            
            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((diff % (1000 * 60)) / 1000);

            
            document.getElementById('runtime-days').innerText = days;
            document.getElementById('runtime-hours').innerText = hours;
            document.getElementById('runtime-mins').innerText = minutes;
            document.getElementById('runtime-secs').innerText = seconds;
        }

        
        updateRuntime();
        
        setInterval(updateRuntime, 1000);

        
        document.addEventListener('DOMContentLoaded', function() {
            const progressBar = document.getElementById('readingProgress');
            
            if (progressBar) {
                
                window.addEventListener('scroll', function() {
                    const windowHeight = window.innerHeight;
                    const documentHeight = document.documentElement.scrollHeight - windowHeight;
                    const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
                    
                    const progress = (scrollTop / documentHeight) * 100;
                    progressBar.style.width = progress + '%';
                });
                
                
                progressBar.addEventListener('click', function(e) {
                    const rect = this.getBoundingClientRect();
                    const clickPosition = e.clientX - rect.left;
                    const percentage = clickPosition / rect.width;
                    
                    const documentHeight = document.documentElement.scrollHeight - window.innerHeight;
                    const targetPosition = documentHeight * percentage;
                    
                    window.scrollTo({
                        top: targetPosition,
                        behavior: 'smooth'
                    });
                });
            }
        });
    </script>
    
    <style>
     
    .reading-progress {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 3px;
        background: rgba(0, 0, 0, 0.1);
        z-index: 9999;
        backdrop-filter: blur(5px);
    }

    .reading-progress-bar {
        height: 100%;
        background: linear-gradient(90deg, #ff6b6b, #ff8e53, #fea82f, #4ecdc4, #45b7d1);
        width: 0%;
        transition: width 0.1s ease;
        position: relative;
        overflow: hidden;
        cursor: pointer;
    }

    .reading-progress-bar::after {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, 
            transparent, 
            rgba(255,255,255,0.4), 
            transparent);
        animation: shimmer 2s infinite;
    }

    @keyframes shimmer {
        0% { left: -100%; }
        100% { left: 100%; }
    }

     
    ::-webkit-scrollbar {
        width: 8px;
    }

    ::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb {
        background: linear-gradient(180deg, #ff6b6b, #4ecdc4);
        border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
        background: linear-gradient(180deg, #ff5252, #26a69a);
    }
    </style>
    
    
</footer>

    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

<script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>

<meting-js
	server="netease"
	type="playlist"
	id="14194243775"
    list-max-height="100px"
    fixed="true"
    mini="true">
</meting-js>

<script>
    
    const cssPath = 'https:\/\/prominsegsj.github.io\/waifu\/waifu.css'
    const tipsJsonPath = 'https:\/\/prominsegsj.github.io\/waifu\/waifu-tips.json'
    const live2dJsPath = 'https:\/\/prominsegsj.github.io\/waifu\/live2d.min.js'
    
    const live2d_path = "https://fastly.jsdelivr.net/gh/stevenjoezhang/live2d-widget@latest/";


    
    function loadExternalResource(url, type) {
        return new Promise((resolve, reject) => {
            let tag;
            if (type === "css") {
                tag = document.createElement("link");
                tag.rel = "stylesheet";
                tag.href = url;
            }
            else if (type === "js") {
                tag = document.createElement("script");
                tag.src = url;
            }
            if (tag) {
                tag.onload = () => resolve(url);
                tag.onerror = () => reject(url);
                document.head.appendChild(tag);
            }
        });
    }

    
    if (screen.width >= 768) {
        Promise.all([
            loadExternalResource(cssPath, "css"),
            loadExternalResource(live2dJsPath, "js"),
            loadExternalResource(live2d_path + "waifu-tips.js", "js")
        ]).then(() => {
            
            initWidget({
                waifuPath: tipsJsonPath,
                cdnPath: "https://cdn.jsdelivr.net/gh/prominsegsj/static-resource@v1.0.0",
                tools: ["hitokoto", "asteroids", "switch-model", "switch-texture", "photo", "info", "quit"]
            });
            initWaifuMouseEvent();
        });
    }
   
    function initWaifuMouseEvent() {
        const waifu = document.getElementById("waifu");
        let isDown = false;
        let waifuLeft;
        let mouseLeft;
        let waifuTop;
        let mouseTop;
        
        waifu.onmousedown = function (e) {
            isDown = true;
            
            waifuLeft = waifu.offsetLeft;
            mouseLeft = e.clientX;
            
            waifuTop = waifu.offsetTop;
            mouseTop = e.clientY;
        }
        
        window.onmousemove = function (e) {
            if (!isDown) {
                return;
            }
            
            let currentLeft = waifuLeft + (e.clientX - mouseLeft);
            if (currentLeft < 0) {
                currentLeft = 0;
            } else if (currentLeft > window.innerWidth - 300) {
                currentLeft = window.innerWidth - 300;
            }
            waifu.style.left = currentLeft  + "px";
            
            
            
            
            
            
            
            
        }
        
        window.onmouseup = function (e) {
            isDown = false;
        }
    }  
</script>

<style>
    @font-face {
      font-family: 'ShinRetroMaruGothic';
      src: url('https://prominsegsj.github.io/font/ShinRetroMaruGothic-Medium.ttf') format('truetype');
    }
  
    :root {
      --base-font-family: 'ShinRetroMaruGothic';
      --code-font-family: 'ShinRetroMaruGothic';
    }
</style>
  
<style>

body,
html,
.article-content img {
  cursor: url(/mouse/normal1.png),
  auto !important;
}

a:hover,
button:hover,
.copyCodeButton:hover,
#dark-mode-toggle {
  cursor: url(/mouse/click_hu.png),
  auto;
}

input:hover,
.site-description,
.article-subtitle,
.article-content span,
.article-content li,
.article-content p {
  cursor: url(/mouse/text_hu.png),
  auto;
}

</style>

<style>
    #TableOfContents > ul, ol {
        ul, ol {
            display: none;
        }
        .open {
            display: block;
        }
    }
</style>

<script>
    function initTocHide() {
        
        let toc = document.querySelector(".widget--toc");
        if (!toc) {
            return;
        }
        
        window.addEventListener('scroll', function() {
            
            let openUl = document.querySelectorAll(".open");
            if (openUl.length > 0) {
              openUl.forEach((ul) => {
                ul.classList.remove("open")
              })
            }
            
            let currentLi = document.querySelector(".active-class");
            if (!currentLi) {
                return
            }
            
            if (currentLi.children.length > 1) {
                currentLi.children[1].classList.add("open")
            }
            
            let ul = currentLi.parentElement;
            do {
                ul.classList.add("open");
                ul = ul.parentElement.parentElement
            } while (ul !== undefined && (ul.localName === 'ul' || ul.localName === 'ol'))
        });
    }
    initTocHide()
</script>

<style>
    #backTopBtn {
        display: none;
        position: fixed;
        bottom: 30px;
        z-index: 99;
        cursor: pointer;
        width: 30px;
        height: 30px;
        background-image: url('https://prominsegsj.github.io/icons/backTop.svg');
    }
</style>

<script>
    

    function initScrollTop() {
        let rightSideBar = document.querySelector(".right-sidebar");
        if (!rightSideBar) {
            return;
        }
        
        let btn = document.createElement("div");
        btn.id = "backTopBtn";
        btn.onclick = backToTop
        rightSideBar.appendChild(btn)
        
        window.onscroll = function() {
            
            if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
                btn.style.display = "block";
            } else {
                btn.style.display = "none";
            }
        };
    }

    

    function backToTop(){
        window.scrollTo({ top: 0, behavior: "smooth" })
    }

    initScrollTop();
</script>

<style>
    .highlight {
         
        max-height: 400px;
        overflow: hidden;
    }

    .code-show {
        max-height: none !important;
    }

    .code-more-box {
        width: 100%;
        padding-top: 78px;
        background-image: -webkit-gradient(linear, left top, left bottom, from(rgba(255, 255, 255, 0)), to(#fff));
        position: absolute;
        left: 0;
        right: 0;
        bottom: 0;
        z-index: 1;
    }

    .code-more-btn {
        display: block;
        margin: auto;
        width: 44px;
        height: 22px;
        background: #f0f0f5;
        border-top-left-radius: 8px;
        border-top-right-radius: 8px;
        padding-top: 6px;
        cursor: pointer;
    }

    .code-more-img {
        cursor: pointer !important;
        display: block;
        margin: auto;
        width: 22px;
        height: 16px;
    }
</style>

<script>
  function initCodeMoreBox() {
    let codeBlocks = document.querySelectorAll(".highlight");
    if (!codeBlocks) {
      return;
    }
    codeBlocks.forEach(codeBlock => {
      
      if (codeBlock.scrollHeight <= codeBlock.clientHeight) {
        return;
      }
      
      
      let codeMoreBox = document.createElement('div');
      codeMoreBox.classList.add('code-more-box');
      
      let codeMoreBtn = document.createElement('span');
      codeMoreBtn.classList.add('code-more-btn');
      codeMoreBtn.addEventListener('click', () => {
        codeBlock.classList.add('code-show');
        codeMoreBox.style.display = 'none';
        
        window.dispatchEvent(new Event('resize'))
      })
      
      let img = document.createElement('img');
      img.classList.add('code-more-img');
      img.src = 'https:\/\/prominsegsj.github.io\/icons\/codeMore.png'
      
      codeMoreBtn.appendChild(img);
      codeMoreBox.appendChild(codeMoreBtn);
      codeBlock.appendChild(codeMoreBox)
    })
  }
  
  initCodeMoreBox();
</script>





  
  
  
  

<script defer src="https://events.vercount.one/js"></script>
  



<div id="background-layer">
    
    <div id="particles-js"></div>
  
    
    <div id="jsi-flying-fish-container"></div>
  </div>
  
  
  <script src="/background/particles.min.js"></script>
  <script src="/fish/renderer.js"></script>
  <script>
    particlesJS.load('particles-js', '/background/particlesjs-config.json', function() {
      console.log('particles.js loaded - callback');
    });
  </script>
  
  
  <style>
     
    #background-layer {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;      
      overflow: hidden;
      pointer-events: none;
    }
  
     
    #particles-js {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 1;       
    }
  
     
    #jsi-flying-fish-container {
      width: 100%;
      height: 200px;
      position: absolute;
      bottom: 0;
      left: 0;
      z-index: 2;       
      opacity: 0.37;
    }
  </style>
  



    </body>
</html>



